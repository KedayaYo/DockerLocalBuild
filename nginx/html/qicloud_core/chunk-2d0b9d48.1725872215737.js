(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0b9d48"],{"352b":function(e,t,s){"use strict";s.r(t);var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"stand-alone-list-wrapper has-padding"},[t("el-card",[t("el-title",{attrs:{slot:"header"},slot:"header"},[e._v(" 单机列表 ")]),t("el-form",{attrs:{size:"small",model:e.searchForm,inline:!0},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",{directives:[{name:"permission",rawName:"v-permission",value:"standAlone/standAlone/add",expression:"'standAlone/standAlone/add'"}],staticClass:"float-right"},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v(" 新建 ")])],1)],1),t("el-table",{attrs:{data:e.standAloneList,"text-align":"center","header-cell-style":e.skyHeadStyle,"row-class-name":e.skyTableRowClassName,"cell-style":e.skyRowStyle,height:"100px"}},[t("template",{slot:"empty"},[t("NoResult",{attrs:{"has-margin":!1}})],1),t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),t("el-table-column",{attrs:{label:"编号",prop:"siteID",align:"center"}}),t("el-table-column",{attrs:{label:"名称",prop:"siteName"}}),e._e(),t("el-table-column",{attrs:{label:"设备配置",prop:"siteMode",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("matching")(t.row.siteMode))+" ")]}}])}),t("el-table-column",{attrs:{label:"飞行模式",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{size:"mini",type:1===s.row.siteSFMode?"success":"warning"}},[e._v(" "+e._s(1===s.row.siteSFMode?"孤岛模式":"跳棋模式")+" ")])]}}])}),t("el-table-column",{attrs:{label:"多机模式",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{size:"mini",type:1===s.row.isMultipleUAV?"success":"warning"}},[e._v(" "+e._s(1===s.row.isMultipleUAV?"开启":"关闭")+" ")])]}}])}),t("el-table-column",{attrs:{label:"创建时间",prop:"createTime",align:"center"}}),t("el-table-column",{attrs:{label:"操作",width:"300",align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"standAlone/standAlone/update",expression:"'standAlone/standAlone/update'"}],attrs:{type:"text"},on:{click:function(t){return e.handleEdit(s.row,!1)}}},[e._v(" 修改 "),t("i",{staticClass:"el-icon-edit"})]),t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"standAlone/standAlone/delete",expression:"'standAlone/standAlone/delete'"}],staticStyle:{color:"#eb5300"},attrs:{type:"text"},on:{click:function(t){return e.handleDeleteStandAlone(s.row.siteID)}}},[e._v(" 删除 "),t("i",{staticClass:"el-icon-delete"})]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(s.row,!0)}}},[e._v(" 详情 "),t("i",{staticClass:"el-icon-search"})])]}}])})],2),t("el-row",{staticClass:"sorter-wrap"},[t("el-pagination",{staticClass:"x-pagination float-right",attrs:{background:"",layout:"total, prev, pager, next, jumper","current-page":e.tableConfig.page,"page-size":e.tableConfig.size,total:e.tableConfig.total},on:{"current-change":e.handleChangeCPage}})],1),t("el-dialog",{staticClass:"protective-line",attrs:{center:"",visible:e.dialogVisible},on:{close:function(t){return e.handleClose("StandAloneForm")}}},[t("el-title",{attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.isEdit?e.disabled?"详情":"编辑":"新建")+" ")]),t("el-form",{ref:"StandAloneForm",attrs:{disabled:e.disabled,"label-position":"right","label-width":"140px",rules:e.rules,size:"small",model:e.standAloneDetails}},[t("el-row",{attrs:{gutter:20}},[e.isEdit?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"编号"}},[e._v(" "+e._s(e.standAloneDetails.siteID)+" ")])],1):e._e(),t("el-col",{attrs:{span:e.isEdit?12:24}},[t("el-form-item",{attrs:{label:"名称",prop:"siteName"}},[t("el-input",{model:{value:e.standAloneDetails.siteName,callback:function(t){e.$set(e.standAloneDetails,"siteName",t)},expression:"standAloneDetails.siteName"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"飞行模式",prop:"siteSFMode"}},[t("el-select",{model:{value:e.standAloneDetails.siteSFMode,callback:function(t){e.$set(e.standAloneDetails,"siteSFMode",t)},expression:"standAloneDetails.siteSFMode"}},[t("el-option",{attrs:{value:1,label:"孤岛模式"}}),t("el-option",{attrs:{value:2,label:"跳棋模式"}})],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"设备配置",prop:"siteMode"}},[t("el-select",{model:{value:e.standAloneDetails.siteMode,callback:function(t){e.$set(e.standAloneDetails,"siteMode",e._n(t))},expression:"standAloneDetails.siteMode"}},e._l(e.SITEMODEL,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"多机配置",prop:"isMultipleUAV"}},[t("el-select",{model:{value:e.standAloneDetails.isMultipleUAV,callback:function(t){e.$set(e.standAloneDetails,"isMultipleUAV",e._n(t))},expression:"standAloneDetails.isMultipleUAV"}},e._l(e.multipleOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"无人机编号"}},[t("el-select",{attrs:{clearable:""},model:{value:e.standAloneDetails.UAVID,callback:function(t){e.$set(e.standAloneDetails,"UAVID",t)},expression:"standAloneDetails.UAVID"}},e._l(e.droneList,(function(e){return t("el-option",{key:e.UAVID,attrs:{value:e.UAVID,label:e.UAVID}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"边缘计算机"}},[t("el-select",{model:{value:e.standAloneDetails.ECID1,callback:function(t){e.$set(e.standAloneDetails,"ECID1",t)},expression:"standAloneDetails.ECID1"}},e._l(e.computerList,(function(e){return t("el-option",{key:e.ECID,attrs:{label:e.ECID,value:e.ECID}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"播流配置"}},[t("el-input",{attrs:{placeholder:"请输入播流IP地址或域名"},model:{value:e.standAloneDetails.videoPullAddr,callback:function(t){e.$set(e.standAloneDetails,"videoPullAddr",t)},expression:"standAloneDetails.videoPullAddr"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"推流配置"}},[t("el-input",{attrs:{placeholder:"请输入推流IP地址或域名"},model:{value:e.standAloneDetails.videoPushAddr,callback:function(t){e.$set(e.standAloneDetails,"videoPushAddr",t)},expression:"standAloneDetails.videoPushAddr"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"上传图片"}},[e.standAloneDetails.thumbnailBase64?t("el-button",{attrs:{type:"text",icon:"el-icon-picture-outline"},on:{click:function(t){e.imgCropperDialogVisible=!0}}},[e._v(" "+e._s(e.standAloneDetails.siteName)+" ")]):t("el-button",{on:{click:function(t){e.imgCropperDialogVisible=!0}}},[t("i",{staticClass:"el-icon-upload"}),e._v(" 上传图片 ")])],1)],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.disabled?e._e():t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-success"},on:{click:function(t){return e.submit("StandAloneForm")}}},[e._v("确 定")]),t("el-button",{attrs:{plain:"",size:"small",icon:"el-icon-error",type:"primary"},on:{click:function(t){return e.resetForm("StandAloneForm")}}},[e._v("取 消")])],1)],1),t("el-drawer",{attrs:{visible:e.imgCropperDialogVisible,"before-close":e.handleCloseImgCropper}},[t("el-title",{attrs:{slot:"title"},slot:"title"},[e._v(" 裁剪器 ")]),e.imgCropperDialogVisible?t("ImgCropper",{attrs:{"base-code":e.standAloneDetails.thumbnailBase64},on:{sendCropperImg:e.handleCropperImg}}):e._e()],1)],1),t("SiteDeviceSourceDialog",{attrs:{visible:e.siteDeviceSourceDialogVisible,source:e.currentSite,sole:!0},on:{"update:visible":function(t){e.siteDeviceSourceDialogVisible=t}}})],1)},i=[],a=(s("d9e2"),s("14d9"),s("13d5"),s("a670")),o=s("514b"),n=s("61f7"),r=s("b7c3"),d=s("5697");const c=[{value:0,label:"关闭"},{value:1,label:"开启"}];var u={name:"StandAlone",components:{ImgCropper:a["a"],SiteDeviceSourceDialog:d["a"]},filters:{matching(e){return r["g"].SITEMODE.getDescFromValue(e)}},data(){return{disabled:!1,dialogVisible:!1,isEdit:!1,imgCropperDialogVisible:!1,siteDeviceSourceDialogVisible:!1,standAloneList:[],droneList:[],computerList:[],standModes:[3,4,5],multipleOptions:c,searchForm:{corporation:""},currentSite:{},tableConfig:{page:1,size:20,total:0,isSiteType:0},standAloneDetails:{siteID:"",siteName:"",siteAddress:"",siteMode:"",siteSFMode:"",UAVID:"",ECID1:"",videoPullAddr:"",videoPushAddr:""},rules:{UAVID:[{required:!0,message:"请选择无人机",trigger:"change"}],siteName:[{required:!0,validator:n["k"],trigger:"blur"}],siteMode:[{required:!0,message:"请选择站点模式",trigger:"change"}],siteSFMode:[{required:!0,message:"请选择类型",trigger:"change"}],ECID1:[{required:!0,message:"请选择边缘计算机",trigger:"change"}]}}},computed:{SITEMODEL(){return r["i"].map(e=>({value:e,label:r["g"].SITEMODE.getDescFromValue(e)}))}},created(){this.getStandAloneList(this.tableConfig),this.getDroneList(1,500),this.getComputerList()},methods:{handleOpenSiteDeviceSourceDialog(e){this.currentSite=e,this.siteDeviceSourceDialogVisible=!0},handleChangeCPage(e){this.tableConfig.page=e,this.getStandAloneList(this.tableConfig)},async handleEdit(e,t){this.disabled=t;const{code:s,data:l,reason:i}=await this.$store.dispatch("site/getSiteDetail",{siteID:e.siteID});if(!Object(o["a"])(s))return this.$message.error("站点详情获取失败："+i);this.isEdit=!0;const a=this.$deepClone(l);return Object.keys(this.standAloneDetails).forEach(e=>{var t;"UAVID"===e?this.standAloneDetails.UAVID=null===(t=a.UAVInfo)||void 0===t?void 0:t.UAVID:this.standAloneDetails[e]=a[e]}),this.dialogVisible=!0,""},handleClose(e){this.resetForm(e)},handleCloseImgCropper(){this.imgCropperDialogVisible=!1},handleCropperImg(e){const{close:t,base64:s}=e;this.standAloneDetails.thumbnailBase64=s,t&&this.handleCloseImgCropper()},handleDeleteStandAlone(e){this.$confirm("此操作将此单机系统, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const{code:t,reason:s}=await this.$store.dispatch("site/deleteSite",{siteID:e});return Object(o["a"])(t)?(this.$message({type:"success",message:"删除成功!"}),this.getStandAloneList(this.tableConfig),""):this.$message.error(s)}).catch(e=>{throw this.$message({type:"info",message:"已取消删除"}),console.error(e),new Error(e)})},submit(e){this.$refs[e].validate(async t=>{if(t){const t=this.$deepClone(this.standAloneDetails);Object.keys(t).forEach(e=>{t[e]||"UAVID"===e||delete t[e]}),this.isEdit&&(t.siteID=this.standAloneDetails.siteID);const{code:s,reason:l}=this.isEdit?await this.$store.dispatch("site/updateSiteDetails",t):await this.$store.dispatch("site/appendSite",t),i=Object(o["a"])(s);if(this.$message[i?"success":"error"](`${this.isEdit?"修改":"新建"}单机信息 ${i?"成功":"失败"}${i?"":l}`),!i)throw new Error("error");this.getStandAloneList(this.tableConfig),this.resetForm(e)}return!1})},resetForm(e){this.dialogVisible=!1,this.isEdit=!1,this.disabled=!1,this.$refs[e].resetFields(),Object.keys(this.standAloneDetails).forEach(e=>{this.standAloneDetails[e]=""})},async getDroneList(){const{code:e,data:t,reason:s}=await this.$store.dispatch("uav/getDroneList",{page:1,size:500});if(!Object(o["a"])(e))return this.$message.error("获取无人机列表失败："+s);const{list:l}=t;return this.droneList=l,l},async getComputerList(e=1,t=500,s=""){const{code:l,data:i,reason:a}=await this.$store.dispatch("computer/getComputerList",{page:e,size:t,ECID:s});if(!Object(o["a"])(l))return this.$message("请求失败："+a);const{list:n}=i;return this.computerList=n,n},async getStandAloneList({page:e,size:t,PID:s="",isSiteType:l=0,siteIDs:i=""}){const{code:a,data:n,reason:r}=await this.$store.dispatch("site/getSiteList",{page:e,size:t,PID:s,isSiteType:l,siteIDs:i});if(!Object(o["a"])(a))return this.$message.error("请求失败："+r);const{list:d,total:c}=n;return this.standAloneList=d.reduce((e,t)=>(this.standModes.includes(t.siteMode)&&e.push(t),e),[]),this.tableConfig.total=void 0===c?this.tableConfig.total:c||0,d}}},p=u,m=s("2877"),g=Object(m["a"])(p,l,i,!1,null,null,null);t["default"]=g.exports}}]);
//# sourceMappingURL=chunk-2d0b9d48.1725872215737.js.map