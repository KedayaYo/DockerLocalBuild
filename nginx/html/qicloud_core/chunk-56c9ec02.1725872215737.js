(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-56c9ec02"],{"13d5":function(e,t,s){"use strict";var a=s("23e7"),i=s("d58f").left,n=s("a640"),o=s("1212"),l=s("9adc"),r=!l&&o>79&&o<83,c=r||!n("reduce");a({target:"Array",proto:!0,forced:c},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},"1953a":function(e,t,s){"use strict";s("eeff")},"32bb":function(e,t,s){},"6b94":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAVFJREFUOE+dkjssg2EUhp/TpW3cFpfR4hKTxIKqxCAxqIWahRq6SEQEkVgk4rKxGITB4BLpIiFi6kJC0pDf0mA2dVJJpeiRv/X//asl4ZvO957zfuc953sFx9EeqkkxhRBAaMqmlDjCMW42JErCKhcr0HaGcLENVDkfs2PlGWVMroiYWJb4RTqy7iWJOVDJMGySRbup4Y1HhMpfCPmU2dlFo2gni8CCnTlLgBGFmWAOqgOWLmC8K0/OsCzawS1Cq42uRcA/CIercDAHe0nwloPPXocp+M7s+Aq4C2SGZiG0AukUfLzDtB9uDKfcdGmiWXKpucLrU5js/z7+S7HUeg9sPYGnDKL70DsCsXOY6HN2NIqXsxuDhjYIt4ARh/lNCIQLZ8wux0ctGR7+/B3/NoDDckGEHYSKHyyXRBktsJxNtkzuYgBoRkkD9ygneFl3mvwTFi5xkQkl0JMAAAAASUVORK5CYII="},7879:function(e,t,s){},"7a6f":function(e,t,s){"use strict";s("fbf7")},8558:function(e,t,s){"use strict";var a=s("cfe9"),i=s("b5db"),n=s("c6b6"),o=function(e){return i.slice(0,e.length)===e};e.exports=function(){return o("Bun/")?"BUN":o("Cloudflare-Workers")?"CLOUDFLARE":o("Deno/")?"DENO":o("Node.js/")?"NODE":a.Bun&&"string"==typeof Bun.version?"BUN":a.Deno&&"object"==typeof Deno.version?"DENO":"process"===n(a.process)?"NODE":a.window&&a.document?"BROWSER":"REST"}()},"9adc":function(e,t,s){"use strict";var a=s("8558");e.exports="NODE"===a},a640:function(e,t,s){"use strict";var a=s("d039");e.exports=function(e,t){var s=[][e];return!!s&&a((function(){s.call(null,t||function(){return 1},1)}))}},d33f:function(e,t,s){"use strict";s("32bb")},d58f:function(e,t,s){"use strict";var a=s("59ed"),i=s("7b0b"),n=s("44ad"),o=s("07fa"),l=TypeError,r="Reduce of empty array with no initial value",c=function(e){return function(t,s,c,d){var m=i(t),u=n(m),h=o(m);if(a(s),0===h&&c<2)throw new l(r);var p=e?h-1:0,f=e?-1:1;if(c<2)while(1){if(p in u){d=u[p],p+=f;break}if(p+=f,e?p<0:h<=p)throw new l(r)}for(;e?p>=0:h>p;p+=f)p in u&&(d=s(d,u[p],p,m));return d}};e.exports={left:c(!1),right:c(!0)}},d5b0:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAPFJREFUOE+dkjFOAmEUhL+hwEaBQr2BWnIRrJQDaGuHxo6GAhNYCkws9QKGhsR7GG2MegQLRQpCsWMWwy5L/E3gdS9v5v3zzxuxWJG3MQ1EDbM/G4kXzBBxzYU+5nClvI6PELeIcm5Z1oyIOeVSg999SSWkAvdpH2ACJqaekLXZ9s64yDtQCuNzkxFmT3TdQjSXSZ9nULkJrDJXIvIjUF2G+BzUC2p4Tl6cIDZWIprpekQYB6XGDVB2LL4muT8/Bc351+GZOV3vIt5WP8e6AUglRT7G3CG2/pRpvjEn+cjNkVnIDzEHwBTxSswDBfqLIf8BPQJaKRmdxTYAAAAASUVORK5CYII="},ec9e:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"schedule-mission-wrap has-padding"},[t("el-card",[t("el-title",{attrs:{slot:"header"},slot:"header"},[e._v(" 计划任务 ")]),t("el-form",{attrs:{inline:!0,size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[t("el-form-item",[t("el-select",{attrs:{clearable:"",placeholder:"请选择点位"},model:{value:e.scheduleQuery.siteID,callback:function(t){e.$set(e.scheduleQuery,"siteID",t)},expression:"scheduleQuery.siteID"}},e._l(e.siteList,(function(e){return t("el-option",{key:e.siteID,attrs:{value:e.value,label:e.label}})})),1)],1),t("el-form-item",[t("el-date-picker",{staticStyle:{height:"34px"},attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},on:{change:e.handleChange},model:{value:e.scheduleQuery.queryTimes,callback:function(t){e.$set(e.scheduleQuery,"queryTimes",t)},expression:"scheduleQuery.queryTimes"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.handleQuery()}}},[e._v(" 查询 ")])],1),t("el-form-item",{directives:[{name:"permission",rawName:"v-permission",value:"plan/plan/add",expression:"'plan/plan/add'"}],staticClass:"float-right"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:e.augmentSchedule}},[e._v(" 新建 ")])],1)],1),t("el-table",{attrs:{data:e.planMissionList,"header-cell-style":e.headStyle,"row-class-name":e.tableRowClassName,"cell-style":e.rowStyle,height:"100px"}},[t("template",{slot:"empty"},[t("NoResult",{attrs:{"has-margin":!1}})],1),t("el-table-column",{attrs:{type:"index",align:"center",label:"序号"}}),t("el-table-column",{attrs:{label:"计划任务编号",prop:"CMID"}}),t("el-table-column",{attrs:{label:"详情",width:"90"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.handleShowChildren(s.row)}}},[e._v(" 子任务 ")])]}}])}),t("el-table-column",{attrs:{label:"任务名称",prop:"missionName"}}),t("el-table-column",{attrs:{label:"点位名称",prop:"siteName"}}),t("el-table-column",{attrs:{label:"航线任务编号",prop:"missionID"}}),t("el-table-column",{attrs:{label:"模式",prop:"mode",width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._f("planMissionModeFilter")(t.row.mode))+" ")]}}])}),t("el-table-column",{attrs:{label:"开始时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(1===t.row.mode?e.$moment(1e3*t.row.excuteList[0].excuteTime).format("YYYY-MM-DD"):-1===t.row.startDate?"--":e.$moment(1e3*t.row.startDate).format("YYYY-MM-DD"))+" ")]}}])}),t("el-table-column",{attrs:{label:"结束时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(1===t.row.mode?e.$moment(1e3*t.row.excuteList[0].excuteTime).format("YYYY-MM-DD"):-1===t.row.endDate?"--":e.$moment(1e3*t.row.endDate).format("YYYY-MM-DD"))+" ")]}}])}),t("el-table-column",{attrs:{label:"执行时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s((t.row.mode,e.$moment(1e3*t.row.excuteList[0].excuteTime).format("HH:mm:ss")))+" ")]}}])}),t("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{staticClass:"mission-state"},[t("img",{attrs:{src:1===s.row.state?e.CLOCK:2===s.row.state?e.WARNING:e.SUCCESS}}),e._v(" "+e._s(1==s.row.state?"未生效":2==s.row.state?"生效中":"已结束")+" ")])]}}])}),t("el-table-column",{attrs:{label:"创建时间",prop:"createTime"}}),t("el-table-column",{attrs:{label:"更新时间",prop:"updateTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(Boolean(t.row.updateTime)?t.row.updateTime:"--")+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"plan/plan/update",expression:"'plan/plan/update'"}],attrs:{disabled:3===s.row.state,type:"text"},on:{click:function(t){return e.handleEdit(s.row,!1)}}},[e._v(" 修改 "),t("i",{staticClass:"el-icon-edit"})]),t("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"plan/plan/delete",expression:"'plan/plan/delete'"}],staticClass:"sky-danger",attrs:{type:"text"},on:{click:function(t){return e.handleRemove(s.row)}}},[e._v(" 删除 "),t("i",{staticClass:"el-icon-delete"})]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleEdit(s.row,!0)}}},[e._v(" 详情 "),t("i",{staticClass:"el-icon-search"})])]}}])})],2),t("el-row",{staticClass:"sorter-wrap"},[t("el-pagination",{staticClass:"x-pagination float-right",attrs:{background:"",layout:"total, prev, pager, next, jumper","page-size":e.tableConfig.size,total:e.tableConfig.total},on:{"current-change":e.handleChangeCPage}})],1)],1),t("el-dialog",{attrs:{visible:e.showChildren,width:"700px"},on:{close:e.handleCloseChildren}},[t("el-title",{attrs:{slot:"title"},slot:"title"},[e._v(" 子任务 ")]),t("el-table",{key:Math.random()+"fhjsda",attrs:{data:e.childrenMission.slice(8*(e.page-1),8*e.page),"header-cell-style":e.headStyle,"row-class-name":e.tableRowClassName,"cell-style":e.rowStyle,height:"400"}},[t("el-table-column",{attrs:{label:"序号",prop:"id",width:"60"}}),t("el-table-column",{attrs:{label:"任务状态"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{staticClass:"mission-state"},[t("img",{attrs:{src:1===s.row.isExcute?e.SUCCESS:e.ERROR}}),e._v(" "+e._s(1==s.row.isExcute?"已执行":"未执行")+" ")])]}}])}),t("el-table-column",{attrs:{label:"执行时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.$moment(1e3*t.row.excuteTime).format("YYYY-MM-DD HH:mm:ss"))+" ")]}}])}),t("el-table-column",{directives:[{name:"permission",rawName:"v-permission",value:"plan/plan/update",expression:"'plan/plan/update'"}],attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-switch",{attrs:{disabled:1===s.row.isExcute},on:{change:function(t){return e.handleActiveCromission(s.row)}},model:{value:s.row.isDisabled,callback:function(t){e.$set(s.row,"isDisabled",t)},expression:"scope.row.isDisabled"}})]}}])})],1),t("el-row",{staticClass:"sorter-wrap"},[t("el-pagination",{staticClass:"x-pagination float-right",attrs:{background:"",layout:"total, prev, pager, next, jumper","page-size":8,"current-page":e.page,total:e.childrenMission.length},on:{"current-change":e.handleChangeCurrentPage}})],1)],1),t("el-dialog",{staticClass:"dialog-padding protective-line",attrs:{center:"",visible:e.dialogVisible},on:{close:e.handleClose}},[t("el-title",{attrs:{slot:"title"},slot:"title"},[e._v(" "+e._s(e.isEdit?e.disabled?"详情":"编辑":"新建")+" ")]),t("SetPlanForm",{key:1e3*Math.random(),ref:"PlanForm",attrs:{"is-editor":e.isEdit,disabled:e.disabled,data:e.missionDetails}}),t("span",{attrs:{slot:"footer"},slot:"footer"},[e.disabled?e._e():t("el-button",{attrs:{icon:"el-icon-success",type:"primary"},on:{click:function(t){return e.submit("PlanForm")}}},[e._v("确定")]),t("el-button",{attrs:{icon:"el-icon-error",type:"primary",plain:""},on:{click:e.handleClose}},[e._v("取消")])],1)],1)],1)},i=[],n=(s("14d9"),s("13d5"),function(){var e=this,t=e._self._c;return t("el-form",{ref:"PlanMForm",staticClass:"plan-form-wrapper",attrs:{"label-position":"left","label-width":"80px",model:e.planInformations,rules:e.rules,disabled:e.disabled,"hide-required-asterisk":!0}},[t("el-form-item",{attrs:{label:"选择任务",prop:"cascaderValue"}},[t("el-cascader",{staticStyle:{width:"100%"},attrs:{disabled:e.isEditor,props:{lazy:!0,lazyLoad:e.lazyLoad}},on:{change:e.handleChangeOption},model:{value:e.planInformations.cascaderValue,callback:function(t){e.$set(e.planInformations,"cascaderValue",t)},expression:"planInformations.cascaderValue"}})],1),e.isJump&&e.planInformations.endSiteID?t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"跳飞模式"}},[t("el-checkbox",{attrs:{disabled:e.isEditor},on:{change:e.handleChangeFlightMode},model:{value:e.planInformations.isNetWork,callback:function(t){e.$set(e.planInformations,"isNetWork",t)},expression:"planInformations.isNetWork"}})],1)],1),e.planInformations.isNetWork?t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"终点站点",prop:"endSiteID"}},[t("el-select",{attrs:{disabled:e.isEditor},model:{value:e.planInformations.endSiteID,callback:function(t){e.$set(e.planInformations,"endSiteID",t)},expression:"planInformations.endSiteID"}},e._l(e.legalSites,(function(e){return t("el-option",{key:e.siteName,attrs:{value:e.siteID,label:e.siteName}})})),1)],1)],1):e._e()],1):e._e(),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"执行模式",prop:"mode"}},[t("el-select",{attrs:{disabled:e.isEditor},on:{change:e.handleChangeMode},model:{value:e.planInformations.mode,callback:function(t){e.$set(e.planInformations,"mode",t)},expression:"planInformations.mode"}},e._l(e.PLANMISSIONMODELS,(function(e){return t("el-option",{key:e.key,attrs:{value:e.value,label:e.label}})})),1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{staticClass:"timer-select",attrs:{label:"执行时间",prop:"time","value-format":"hh:mm:ss"}},[t("el-time-picker",{key:"time-picker",staticStyle:{width:"193px"},attrs:{"value-format":"HH:mm:ss",placeholder:"执行时间"},model:{value:e.planInformations.time,callback:function(t){e.$set(e.planInformations,"time",t)},expression:"planInformations.time"}})],1)],1)],1),3===e.planInformations.mode||4===e.planInformations.mode?t("el-form-item",{attrs:{label:"选择日期"}},[t("SelectComponent",{attrs:{checkeds:e.checkeds,type:3===e.planInformations.mode?"W":"M"},on:{date:e.handleChangeDate}})],1):e._e(),t("el-form-item",{attrs:{label:1===e.planInformations.mode?"执行日期":"生效范围",prop:"excuteTime"}},[1===e.planInformations.mode?t("el-date-picker",{key:"time-picker2",attrs:{type:"date",placeholder:"执行日期"},model:{value:e.planInformations.excuteTime,callback:function(t){e.$set(e.planInformations,"excuteTime",t)},expression:"planInformations.excuteTime"}}):t("el-date-picker",{attrs:{type:"datetimerange","range-seprator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.planInformations.excuteTime,callback:function(t){e.$set(e.planInformations,"excuteTime",t)},expression:"planInformations.excuteTime"}})],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入内容"},model:{value:e.planInformations.content,callback:function(t){e.$set(e.planInformations,"content",t)},expression:"planInformations.content"}})],1)],1)}),o=[],l=(s("d9e2"),s("2f62")),r=function(){var e=this,t=e._self._c;return t("div",{class:["deta-select-wrap",e.size?"deta-select-wrap--"+e.size:""]},[t("div",{staticClass:"options-wrap"},[t("div",{staticClass:"checked-options-wrap"},[t("div",{staticClass:"checked-options-area"},e._l(e.checkedList,(function(s,a){return t("span",{key:a,staticClass:"checked-option"},[t("span",[e._v(e._s("W"===e.type?e.weekDays[s]:s))]),t("i",{staticClass:"el-icon-circle-close",on:{click:function(t){return e.handleClick(s)}}})])})),0),t("div",{staticClass:"options-down-btn"},[t("i",{class:e.show?"el-icon-caret-top":"el-icon-caret-bottom",on:{click:function(t){e.show=!e.show}}})])]),t("transition",{attrs:{name:"fade"}},[e.show?t("div",{staticClass:"options"},[t("ul",{staticClass:"options-floor-wrap"},e._l(e.options,(function(s,a){return t("li",{key:"floor-"+a,class:[a<e.options.length-1?"options-floor":"options-floor-end"]},e._l(s,(function(s){return t("span",{key:`option-${a}-${s}`,staticClass:"option",class:[e.checkedList.includes(s)?"active":""],on:{click:function(t){return e.handleClick(s)}}},[e._v(e._s("W"===e.type?e.weekDays[s]:s))])})),0)})),0)]):e._e()])],1)])},c=[],d={name:"DetaSelect",props:{size:{type:String,default:""},type:{type:String,default:"M"},checkeds:{type:Array,default(){return[]}}},data(){return{show:!1,options:[],checkedList:[],weekDays:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"}}},watch:{type:{deep:!0,handler(e){this.checkedList=[],this.options=this.formatArr("W"===e?7:31,7)}}},created(){this.options=this.formatArr("W"===this.type?7:31,7),this.checkedList=this.checkeds},methods:{handleClick(e){const t=this.checkedList.findIndex(t=>t===e);t>-1?this.checkedList.splice(t,1):this.checkedList.push(e),this.$emit("date",this.checkedList)},formatArr(e,t){const s=Array.apply(null,{length:e}).map((e,t)=>"W"===this.type?t:t+1),a=[];for(let i=0;i<s.length;i+=t)a.push(s.slice(i,i+t));return a}}},m=d,u=(s("ee1e"),s("7a6f"),s("2877")),h=Object(u["a"])(m,r,c,!1,null,"ab748ffa",null),p=h.exports;const f=[{value:1,label:"单次"},{value:2,label:"每天"},{value:3,label:"每周"},{value:4,label:"每月"}];var g=f,b=s("b7c3"),C=s("514b");const A={0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},D=2;var w={name:"PlanForm",components:{SelectComponent:p},props:{isEditor:{type:Boolean,default(){return!1}},disabled:{type:Boolean,default(){return!1}},data:{type:Object,default(){return{}}}},data(){return{PLANMISSIONMODELS:g,checkeds:[],siteList:[],legalSites:[],currentSite:{},siteMissions:{},planInformations:{siteID:"",missionID:"",missionName:"",cascaderValue:[],endSiteID:"",mode:1,time:"",excuteTime:"",weekDay:[],day:[],content:""},planTemplate:{siteID:"",missionID:"",missionName:"",mode:"",min:-1,hour:-1,day:[],weekDay:[],excuteTime:-1,content:"",startDate:-1,endDate:-1,CPID:"",PID:""},rules:{mode:[{required:!0,message:"请选择模式",trigger:"change"}],cascaderValue:[{required:!0,message:"请选择任务",trigger:"change"}],endSiteID:[{required:!0,message:"请选择任务",trigger:"change"}],time:[{required:!0,message:"请选择时间",trigger:"change"}],excuteTime:[{required:!0,message:"请选择日期",trigger:"change"}]}}},computed:{workspace(){let e="";if(3===this.planInformations.mode){const t=this.planInformations.weekDay;if(t&&t.length>0)for(let s=0;s<t.length;s+1){const a=A[s];e+=a,s!==t.length-1&&(e+=",")}}else if(4===this.planInformations.mode){const t=this.planInformations.day;if(t&&t.length>0)for(let s=0;s<t.length;s+1){const a=t[s];e+=a,t.length!==s+1&&(e+=",")}}return e},isJump(){return this.currentSite.siteSFMode===D}},created(){(async()=>{if("{}"!==JSON.stringify(this.data)){const{code:e,data:t,reason:s}=await this.fetch();this.siteList=t.list,this.reverseTranscription(this.data)}})()},methods:{...Object(l["b"])({fetch:"site/getSiteGroup",fetchMissiomPagination:"mission/getMissionsList",fetchMissions:"site/getMissions"}),async lazyLoad(e,t){const{level:s}=e;if(0===s){const{code:e,data:s,reason:a}=await this.fetch();if(Object(C["a"])(e)&&s){this.siteList=s.list;const e=s.list.reduce((e,t)=>{if(b["h"].includes(t.siteMode)){const s={value:t.siteID,label:t.siteName,leaf:!1};e.push(s)}return e},[]);t(e)}else this.siteList=[],this.$message.error("站点列表请求失败："+a)}if(1===s){const{value:s}=e,{code:i,data:n,reason:o}=await this.fetchMissions({siteIDs:s});if(!Object(C["a"])(i)||!n)return this.$message.error("请求任务失败"+o);{var a;const{list:e}=n,i=null===(a=e[0].missionList)||void 0===a?void 0:a.reduce((e,t)=>(t&&e.push({value:t.missionID,label:t.missionName,leaf:1}),e),[]);this.siteMissions={[s]:i},t(i)}}return""},handleChangeFlightMode(e){e||(this.planInformations.endSiteID="",console.log(this.planInformations.endSiteID))},handleChangeOption(e){const[t]=e;this.currentSite=this.siteList.find(e=>e.siteID===t),this.legalSites=this.siteList.filter(e=>e.siteSFMode===D&&e.siteID!==t)},handleChangeMode(e){1===e&&(this.planInformations.excuteTime="")},handleChangeDate(e){const t={3:"weekDay",4:"day"};this.planTemplate[t[this.planInformations.mode]]=JSON.parse(JSON.stringify(e))},reverseTranscription(e){const{CMID:t,siteID:s,missionID:a,mode:i,weekDay:n,day:o,endSiteID:l,excuteList:[{excuteTime:r}],excuteTime:c,startDate:d,endDate:m,content:u}=e;this.handleChangeOption([s]),this.currentSite&&l&&(this.planInformations.isNetWork=!0),this.planInformations.cascaderValue=[s,a],this.planInformations.mode=i,this.planInformations.time=this.$moment(1e3*r).format("HH:mm:ss"),this.planInformations.excuteTime=c>-1?1e3*c:[d,m].map(e=>1e3*e),this.planInformations.content=u,this.planInformations.CMID=t,this.planInformations.endSiteID=l,this.checkeds=n.concat(o),3!==i&&4!==i||this.handleChangeDate(this.checkeds)},submit(){return new Promise((e,t)=>{this.$refs.PlanMForm.validate(s=>{if(s){const t={},{CMID:s,cascaderValue:[a,i],mode:n,excuteTime:o,time:l,content:r}=this.planInformations;console.log(this.siteMissions[a]);const[{label:c}]=this.siteMissions[a].filter(e=>e.value===i);if(s&&(t.CMID=s),t.missionID=i,t.missionName=c,t.mode=n,t.siteID=a,t.excuteTime=-1,t.content=r,1===n){const s=this.$moment(o).format("YYYY-MM-DD HH:mm:ss").split(" ")[0];return t.excuteTime=new Date(`${s} ${l}`).getTime()/1e3,console.log(t),e(this.formatByTemplate(t))}const[d,m]=l.split(":").map(Number),[u,h]=o.map(e=>new Date(e).getTime()/1e3);t.hour=d,t.min=m,t.startDate=u,t.endDate=h,e(this.formatByTemplate(t))}t(new Error("error"))})})},formatByTemplate(e){const t=this.$deepClone(this.planTemplate);return Object.keys(e).forEach(s=>{t[s]=e[s]}),console.log(t),t}}},I=w,y=(s("1953a"),Object(u["a"])(I,n,o,!1,null,"3cfa75c2",null)),k=y.exports,v=s("1165");function x(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}var S=s("d5b0"),M=s.n(S),E=s("ee04"),T=s.n(E),N=s("ecc8"),O=s.n(N),R=s("6b94"),L=s.n(R),Y={name:"ScheduleMission",components:{SetPlanForm:k},filters:{planMissionModeFilter:v["h"]},data(){return{page:1,disabled:!1,showChildren:!1,dialogVisible:!1,isEdit:!1,siteList:[],planMissionList:[],childrenMission:[],CLOCK:M.a,WARNING:T.a,SUCCESS:O.a,ERROR:L.a,missionDetails:{},tableConfig:{total:0,size:13,page:1},scheduleQuery:{siteID:"",queryTimes:[]},pickerOptions:{shortcuts:[{text:"最近一周",onClick(e){const t=new Date,s=new Date;s.setTime(s.getTime()-6048e5),e.$emit("pick",[s,t])}},{text:"最近一个月",onClick(e){const t=new Date,s=new Date;s.setTime(s.getTime()-2592e6),e.$emit("pick",[s,t])}},{text:"最近三个月",onClick(e){const t=new Date,s=new Date;s.setTime(s.getTime()-7776e6),e.$emit("pick",[s,t])}}]}}},created(){this.getSiteGroup(),this.gainTableMessageSize({sleep:x}).then(e=>{this.tableConfig.size=e,this.getCronmissions(this.tableConfig)})},methods:{headStyle(){return"text-align:center;background:#F4F7FD"},rowStyle(){return"text-align:center"},tableRowClassName({rowIndex:e}){return e%2===0?"even-number":"uneven-number"},handleChange(){},handleQuery(){const{queryTimes:e}=this.scheduleQuery,[t,s]=e?e.map(e=>this.$moment(e).format("YYYY-MM-DD hh:mm:ss")):[];this.getCronmissions({...this.tableConfig,...this.scheduleQuery,startDate:t,endDate:s})},augmentSchedule(){this.disabled=!1,this.dialogVisible=!0},handleClose(){this.dialogVisible=!1,this.isEdit=!1,this.missionDetails={}},handleCloseChildren(){this.showChildren=!1,this.page=1},handleShowChildren(e){this.childrenMission=e.excuteList.reduce((t,s)=>(s.isDisabled=!s.isDisabled,s.CMID=e.CMID,t.push(s),t),[]),this.showChildren=!0},handleChangeCPage(e){this.tableConfig.page=e,this.getCronmissions(this.tableConfig)},handleChangeCurrentPage(e){this.page=e},handleEdit(e,t){this.disabled=t,this.missionDetails=e,this.isEdit=!0,this.dialogVisible=!0},handleRemove(e){this.$confirm("删除计划任务, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{this.planMissionList=[];const{CMID:t}=e,{code:s,reason:a}=await this.$store.dispatch("schedule/removeCrommission",{CMID:t});if(!Object(C["a"])(s))return this.$message.error("删除失败："+a);this.getCronmissions(this.tableConfig),this.$message({type:"success",message:"删除成功!"})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},submit(e){this.$refs[e].submit().then(async e=>{console.log(e);const{code:t,reason:s}=await this.$store.dispatch("schedule/"+(this.isEdit?"editCromission":"addCronmissions"),e);return Object(C["a"])(t)?(this.$message.success("操作成功"),this.getCronmissions(this.tableConfig),this.handleClose(),""):this.$message.error(s)})},addCronmissions(){const{code:e,reason:t}=this.$store.dispatch("schedule/addCronmissions",this.mission);return Object(C["a"])(e)?"":this.$message.error(""+t)},async handleActiveCromission(e){const{CMID:t,isDisabled:s,excuteTime:a}=e,{code:i,reason:n}=await this.$store.dispatch("schedule/activeCromission",{CMID:t,isDisabled:s?0:1,excuteTime:a});return Object(C["a"])(i)?this.$message.success("操作成功"):this.$message.error(n)},async getSiteGroup(){const{code:e,data:t}=await this.$store.dispatch("site/getSiteGroup");if(!Object(C["a"])(e))return;const{list:s}=t;this.siteList=s.reduce((e,t)=>[...e,{label:t.siteName,value:t.siteID}],[])},async getCronmissions({page:e,size:t,siteID:s,startDate:a="",endDate:i="",mode:n=""}){const{code:o,data:l,reason:r}=await this.$store.dispatch("schedule/getCronmissions",{page:e,size:t,siteID:s,startDate:a,endDate:i,mode:n});if(!Object(C["a"])(o))return this.$message.error(""+r);const{list:c,total:d}=l;return this.planMissionList=c,this.tableConfig.total=void 0===d?this.tableConfig.total:d||0,""}}},G=Y,_=(s("d33f"),Object(u["a"])(G,a,i,!1,null,"50a987f3",null));t["default"]=_.exports},ecc8:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAYNJREFUOE+dkksoRGEUx//nzkxTxpCMR80khTE1C4YsRGRHmYXrsfVYyMJq1izYKBtRNvLYKs2GZqGUukxRaoSF50JZEKsxGPM6upc77jUzlG/1db7/79/5zvkTNMe767SZDG8+FribGM7PJz4HYzOetCxsdVw+qXJSL72So5cFXgGjUGv2LeQwWBjxt9355ZoCKhBhA+C0UTYYICZGvwxTl1Rdkkev1wwqyC7WVwkcTgnJGhIl+zQIk39B485FmMiEuYtRgIUZEvfsxwDqfgN9rmW02DoxdNiI5/gDmOiUxD1HFGBzLnDCvQ5PUSsGglVI8vuXjGI6UHa2GgsxddavCGbrt1GV78bggQeRxKPWO6JrtSKvDnMNAVyEj8FguAo8GDtqx2P05kdDdJIxnGJzJZaa9hWhL+TF7Uso8xfycHqCZaVCynClXUezrQ8WoxU792sZUHod/w6AailK5X0g4yrA1hypeSbGsC5yqlANOYi9AGoJHGPCpcAIvCcs89qQfwDK75ZV+/N7zwAAAABJRU5ErkJggg=="},ee04:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAASFJREFUOE+dkrtOAlEQhr/haowiJMAboMbE2NFRQGElFfAA+gh2xtjYWGuvD6CshcQCTOgIlgRiQpRHsPKSEBIzZoFdd7NnG08158x8M3NmfsFztEWWKccIB8Dm3CWMgQcSXEmVdydcHEOb1IBrYMObzLWVD4QjqWMt8gFL6M65G8HFowINGxa9JYcwQUj5gFIb4hnoFv157MpRCqIW5yhngSo1Ozlgub/5C1EubHCAshcA918gmYNW3tT5SLTJFEgGvJVniKWhs20CZ+FguQ+JLLQLJvArvNWdE4iuwejUBA7Dh7O6XM63gZsP5548P7wF1lHuQSwFT7vmdfxbAK7kLOooN8B6iHI+gUOf5FzYEXmEKsoWygzhFeWRFS69Iv8FB6RcMLtTVDYAAAAASUVORK5CYII="},ee1e:function(e,t,s){"use strict";s("7879")},eeff:function(e,t,s){},fbf7:function(e,t,s){}}]);
//# sourceMappingURL=chunk-56c9ec02.1725872215737.js.map