(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0c18082c"],{"0f2e":function(e,t,s){"use strict";s("39ea")},"1e5a":function(e,t,s){"use strict";var i=s("23e7"),a=s("9961"),n=s("dad2");i({target:"Set",proto:!0,real:!0,forced:!n("symmetricDifference")},{symmetricDifference:a})},"1e70":function(e,t,s){"use strict";var i=s("23e7"),a=s("a5f7"),n=s("dad2");i({target:"Set",proto:!0,real:!0,forced:!n("difference")},{difference:a})},"2a62":function(e,t,s){"use strict";var i=s("c65b"),a=s("825a"),n=s("dc4a");e.exports=function(e,t,s){var r,o;a(e);try{if(r=n(e,"return"),!r){if("throw"===t)throw s;return s}r=i(r,e)}catch(l){o=!0,r=l}if("throw"===t)throw s;if(o)throw r;return a(r),s}},"384f":function(e,t,s){"use strict";var i=s("e330"),a=s("5388"),n=s("cb27"),r=n.Set,o=n.proto,l=i(o.forEach),c=i(o.keys),d=c(new r).next;e.exports=function(e,t,s){return s?a({iterator:c(e),next:d},t):l(e,t)}},"395e":function(e,t,s){"use strict";var i=s("dc19"),a=s("cb27").has,n=s("8e16"),r=s("7f65"),o=s("5388"),l=s("2a62");e.exports=function(e){var t=i(this),s=r(e);if(n(t)<s.size)return!1;var c=s.getIterator();return!1!==o(c,(function(e){if(!a(t,e))return l(c,"normal",!1)}))}},"39ea":function(e,t,s){},4452:function(e,t,s){"use strict";s.d(t,"c",(function(){return d})),s.d(t,"e",(function(){return h})),s.d(t,"o",(function(){return m})),s.d(t,"n",(function(){return c})),s.d(t,"j",(function(){return u})),s.d(t,"k",(function(){return p})),s.d(t,"p",(function(){return T})),s.d(t,"f",(function(){return g})),s.d(t,"m",(function(){return f})),s.d(t,"l",(function(){return y})),s.d(t,"i",(function(){return k})),s.d(t,"b",(function(){return D})),s.d(t,"q",(function(){return b})),s.d(t,"d",(function(){return x})),s.d(t,"a",(function(){return w})),s.d(t,"h",(function(){return v})),s.d(t,"g",(function(){return S}));var i=s("bc3a"),a=s.n(i),n=s("3bcf"),r=s("07fd"),o=s("f121");const{STAT:l}=o["api"];function c(e){return n["a"].get("/statistics/modelDistribution",e).then(({data:e})=>e)}function d(e){return n["a"].get("/statistics/attendanceRank",e).then(({data:e})=>e)}function h(e){return n["a"].get("/statistics/flightHistory",e).then(({data:e})=>e)}function m(e){return n["a"].get("/statistics/realTimeData",e).then(({data:e})=>e)}function u(e){return n["a"].get("/missions/list",{page:1,size:1e5,siteID:e}).then(({data:e})=>e)}function p(e){return n["a"].get("/missions/missioninfo",{missionID:e}).then(({data:e})=>e)}function T(e){return n["a"].post("/uavaction/missionadd",e).then(({data:e})=>e)}function g(e){return n["a"].get("/flightflows/batchinfo",{missionBatch:e}).then(({data:e})=>e)}function f(){return n["a"].get("/sites/list",{page:1,size:1e4}).then(({data:e})=>e)}function y(e,t,s){return n["a"].get("/cronmissions/validlist",{startDate:e,endDate:t,siteID:s}).then(({data:e})=>e)}function k(e,t,s){return n["a"].get("/cronmissions/records",{startDate:t,endDate:s,siteID:e}).then(({data:e})=>e)}function D(e){return n["a"].post("/cronmissions/add",e).then(({data:e})=>e)}function b(e){return n["a"].put("/cronmissions/update",e).then(({data:e})=>e)}function w(e,t){return n["a"].patch("/cronmissions/active",{CMID:e,excuteTime:t,isDisabled:0}).then(({data:e})=>e)}function x(e,t){return n["a"].delete("/cronmissions/delete",{CMID:e,excuteTime:t}).then(({data:e})=>e)}function v(e){return a.a.get(r["e"].gaodeWeather,{params:{key:r["e"].weatherKey,city:e,extensions:"all"}}).then(({data:e})=>e)}function S(e){return a.a.get(r["e"].gaodeLoc,{params:{key:r["e"].weatherKey,location:e,extensions:"all"}}).then(({data:e})=>e)}},"46c4":function(e,t,s){"use strict";e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},5388:function(e,t,s){"use strict";var i=s("c65b");e.exports=function(e,t,s){var a,n,r=s?e:e.iterator,o=e.next;while(!(a=i(o,r)).done)if(n=t(a.value),void 0!==n)return n}},"5eeb":function(e,t,s){"use strict";s("dd21")},"68df":function(e,t,s){"use strict";var i=s("dc19"),a=s("8e16"),n=s("384f"),r=s("7f65");e.exports=function(e){var t=i(this),s=r(e);return!(a(t)>s.size)&&!1!==n(t,(function(e){if(!s.includes(e))return!1}),!0)}},"6b94":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAVFJREFUOE+dkjssg2EUhp/TpW3cFpfR4hKTxIKqxCAxqIWahRq6SEQEkVgk4rKxGITB4BLpIiFi6kJC0pDf0mA2dVJJpeiRv/X//asl4ZvO957zfuc953sFx9EeqkkxhRBAaMqmlDjCMW42JErCKhcr0HaGcLENVDkfs2PlGWVMroiYWJb4RTqy7iWJOVDJMGySRbup4Y1HhMpfCPmU2dlFo2gni8CCnTlLgBGFmWAOqgOWLmC8K0/OsCzawS1Cq42uRcA/CIercDAHe0nwloPPXocp+M7s+Aq4C2SGZiG0AukUfLzDtB9uDKfcdGmiWXKpucLrU5js/z7+S7HUeg9sPYGnDKL70DsCsXOY6HN2NIqXsxuDhjYIt4ARh/lNCIQLZ8wux0ctGR7+/B3/NoDDckGEHYSKHyyXRBktsJxNtkzuYgBoRkkD9ygneFl3mvwTFi5xkQkl0JMAAAAASUVORK5CYII="},"72c3":function(e,t,s){"use strict";var i=s("23e7"),a=s("e9bc"),n=s("dad2");i({target:"Set",proto:!0,real:!0,forced:!n("union")},{union:a})},"79a4":function(e,t,s){"use strict";var i=s("23e7"),a=s("d039"),n=s("953b"),r=s("dad2"),o=!r("intersection")||a((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));i({target:"Set",proto:!0,real:!0,forced:o},{intersection:n})},"7f65":function(e,t,s){"use strict";var i=s("59ed"),a=s("825a"),n=s("c65b"),r=s("5926"),o=s("46c4"),l="Invalid size",c=RangeError,d=TypeError,h=Math.max,m=function(e,t){this.set=e,this.size=h(t,0),this.has=i(e.has),this.keys=i(e.keys)};m.prototype={getIterator:function(){return o(a(n(this.keys,this.set)))},includes:function(e){return n(this.has,this.set,e)}},e.exports=function(e){a(e);var t=+e.size;if(t!==t)throw new d(l);var s=r(t);if(s<0)throw new c(l);return new m(e,s)}},"83b9e":function(e,t,s){"use strict";var i=s("cb27"),a=s("384f"),n=i.Set,r=i.add;e.exports=function(e){var t=new n;return a(e,(function(e){r(t,e)})),t}},"8b00":function(e,t,s){"use strict";var i=s("23e7"),a=s("68df"),n=s("dad2");i({target:"Set",proto:!0,real:!0,forced:!n("isSubsetOf")},{isSubsetOf:a})},"8e16":function(e,t,s){"use strict";var i=s("7282"),a=s("cb27");e.exports=i(a.proto,"size","get")||function(e){return e.size}},"953b":function(e,t,s){"use strict";var i=s("dc19"),a=s("cb27"),n=s("8e16"),r=s("7f65"),o=s("384f"),l=s("5388"),c=a.Set,d=a.add,h=a.has;e.exports=function(e){var t=i(this),s=r(e),a=new c;return n(t)>s.size?l(s.getIterator(),(function(e){h(t,e)&&d(a,e)})):o(t,(function(e){s.includes(e)&&d(a,e)})),a}},9961:function(e,t,s){"use strict";var i=s("dc19"),a=s("cb27"),n=s("83b9e"),r=s("7f65"),o=s("5388"),l=a.add,c=a.has,d=a.remove;e.exports=function(e){var t=i(this),s=r(e).getIterator(),a=n(t);return o(s,(function(e){c(t,e)?d(a,e):l(a,e)})),a}},a2dc:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAaBJREFUOE91kj1rFFEYhZ+ziSgKSsQihYKdv0DQQi20iFZ2FlFSqGCTEM3eBTVrJh/Gj5lEopWghR+EFGIVEoidBBH/QXpBKw2aQsXMkTs7m2TJ+lZ37j3Pe99z54itNe39mDo5fYiu4sj8BGYxCTV9bcq1wT3weTp4AewFPmA+Yow4ijhZ6EQfQ3rZWMZ66B4qLGL+ELSzZYr4kfkAMAecpkIvNzQrUu8BfgDfEFEwQFVPtsFxI/UiooffdIvMj4H+gxV2f17nKmKm8BM02hbObOBNBHPgE1UdK4SpRxAJ5h5Bt7bBqd8hzkQwPsE4QXc2RKknETfJGaOmkRY483VgugmOEpS0CFKPIeqYuwQNb2k6EO00wWWCTrQZawJxm5wJaqqXVhYQZ8WUn2Eus0YHiaLf1krdgGGQqmZKawvquu993ztZxbwn6NR/fkMxHmYFcYR1DjUCMOWLmFfAPGtcItFqm5u/ILoxVwh6vhm5zL3A6zKfS8AyKkJ3HHGujNw1hvR0M3Jl+12PfPjXX8aBC4gdZZMc8ZZOhhnUSnOSf1M4mOsqaU1kAAAAAElFTkSuQmCC"},a4e7:function(e,t,s){"use strict";var i=s("23e7"),a=s("395e"),n=s("dad2");i({target:"Set",proto:!0,real:!0,forced:!n("isSupersetOf")},{isSupersetOf:a})},a5f7:function(e,t,s){"use strict";var i=s("dc19"),a=s("cb27"),n=s("83b9e"),r=s("8e16"),o=s("7f65"),l=s("384f"),c=s("5388"),d=a.has,h=a.remove;e.exports=function(e){var t=i(this),s=o(e),a=n(t);return r(t)<=s.size?l(t,(function(e){s.includes(e)&&h(a,e)})):c(s.getIterator(),(function(e){d(t,e)&&h(a,e)})),a}},b4bc:function(e,t,s){"use strict";var i=s("dc19"),a=s("cb27").has,n=s("8e16"),r=s("7f65"),o=s("384f"),l=s("5388"),c=s("2a62");e.exports=function(e){var t=i(this),s=r(e);if(n(t)<=s.size)return!1!==o(t,(function(e){if(s.includes(e))return!1}),!0);var d=s.getIterator();return!1!==l(d,(function(e){if(a(t,e))return c(d,"normal",!1)}))}},c1a1:function(e,t,s){"use strict";var i=s("23e7"),a=s("b4bc"),n=s("dad2");i({target:"Set",proto:!0,real:!0,forced:!n("isDisjointFrom")},{isDisjointFrom:a})},cb27:function(e,t,s){"use strict";var i=s("e330"),a=Set.prototype;e.exports={Set:Set,add:i(a.add),has:i(a.has),remove:i(a["delete"]),proto:a}},dad2:function(e,t,s){"use strict";var i=s("d066"),a=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};e.exports=function(e){var t=i("Set");try{(new t)[e](a(0));try{return(new t)[e](a(-1)),!1}catch(s){return!0}}catch(n){return!1}}},dc19:function(e,t,s){"use strict";var i=s("cb27").has;e.exports=function(e){return i(e),e}},dd21:function(e,t,s){},e8d8:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"schedule-mission-wrap has-padding"},[t("el-card",[t("el-title",{attrs:{slot:"header"},slot:"header"},[e._v(" 计划任务 ")]),t("div",{staticClass:"main x-scroll-white"},[t("div",{staticClass:"timer",attrs:{id:"table"}},[e.dialogVisible?t("div",{directives:[{name:"drag",rawName:"v-drag"}],staticClass:"new-form-add"},[t("el-title",{attrs:{slot:"header"},slot:"header"},[e._v(" "+e._s(e.selectedTaskIndex>-1?"任务详情":"新建任务")+" ")]),t("div",{staticClass:"close-button"},[t("i",{staticClass:"el-icon-close",on:{click:e.cancelData}})]),t("el-form",{ref:"dataForm",staticStyle:{"margin-top":"20px"},attrs:{disabled:e.selectedTaskIndex>-1&&!e.editAble,"label-width":"80px",rules:e.rules,model:e.tempTask}},[t("el-form-item",{staticClass:"offset-label",attrs:{label:"任务名称",prop:"missionID"}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:e.selectedTaskIndex>-1,placeholder:"请选择任务"},model:{value:e.tempTask.missionID,callback:function(t){e.$set(e.tempTask,"missionID",t)},expression:"tempTask.missionID"}},e._l(e.missionList,(function(e,s){return t("el-option",{key:"mission_"+s,attrs:{value:e.missionID,label:e.missionName}})})),1)],1)],1)],1),t("el-form-item",{staticClass:"offset-label",attrs:{label:"镜头模式",prop:"missionID"}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择镜头模式"},model:{value:e.tempTask.cameraConfig.videoSourceType,callback:function(t){e.$set(e.tempTask.cameraConfig,"videoSourceType",t)},expression:"tempTask.cameraConfig.videoSourceType"}},[t("el-option",{attrs:{value:1,label:"默认镜头"}}),e._l(e.videoSourceTypes,(function(e,s){return t("el-option",{key:"mission_"+s,attrs:{value:e.value,label:e.name}})}))],2)],1)],1)],1),t("el-form-item",{staticClass:"offset-label",attrs:{label:"存储类型",prop:"missionID"}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"","collapse-tags":"",placeholder:"选择媒体存储类型"},model:{value:e.tempTask.cameraConfig.mediaStorageViewTypeArray,callback:function(t){e.$set(e.tempTask.cameraConfig,"mediaStorageViewTypeArray",t)},expression:"tempTask.cameraConfig.mediaStorageViewTypeArray"}},e._l(e.videoSourceTypes,(function(e,s){return t("el-option",{key:"mission_2_"+s,attrs:{value:e.value,label:e.name}})})),1)],1)],1)],1),e.isJumpAble?t("el-form-item",{staticClass:"offset-label",attrs:{label:"飞行模式",prop:"mode"}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-radio",{attrs:{label:!1},model:{value:e.isJump,callback:function(t){e.isJump=t},expression:"isJump"}},[e._v(" 单飞 ")]),t("el-radio",{attrs:{disabled:!e.isJumpAble,label:!0},model:{value:e.isJump,callback:function(t){e.isJump=t},expression:"isJump"}},[e._v(" 跳飞 ")])],1)],1)],1):e._e(),e.isJump?[t("el-form-item",{staticClass:"offset-label",attrs:{label:"降落站点",prop:"endSiteID"}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:e.selectedTaskIndex>-1,placeholder:"请选择降落站点"},model:{value:e.tempTask.endSiteID,callback:function(t){e.$set(e.tempTask,"endSiteID",t)},expression:"tempTask.endSiteID"}},e._l(e.siteListForJump,(function(e,s){return t("el-option",{key:"mission_"+s,attrs:{value:e.siteID,label:e.siteName}})})),1)],1)],1)],1)]:e._e(),t("el-form-item",{staticClass:"offset-label",attrs:{label:"重复设置",prop:"mode"}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-radio",{attrs:{disabled:e.selectedTaskIndex>-1&&e.currentType!=e.timerTypes.one,label:e.timerTypes.one},model:{value:e.currentType,callback:function(t){e.currentType=t},expression:"currentType"}},[e._v(" 一次 ")]),t("el-radio",{attrs:{disabled:e.selectedTaskIndex>-1&&e.currentType!=e.timerTypes.day,label:e.timerTypes.day},model:{value:e.currentType,callback:function(t){e.currentType=t},expression:"currentType"}},[e._v(" 每天 ")])],1),t("el-col",{attrs:{span:24}},[t("el-radio",{attrs:{disabled:e.selectedTaskIndex>-1&&e.currentType!=e.timerTypes.week,label:e.timerTypes.week},model:{value:e.currentType,callback:function(t){e.currentType=t},expression:"currentType"}},[e._v(" 每周 ")]),t("el-radio",{attrs:{disabled:e.selectedTaskIndex>-1&&e.currentType!=e.timerTypes.month,label:e.timerTypes.month},model:{value:e.currentType,callback:function(t){e.currentType=t},expression:"currentType"}},[e._v(" 每月 ")])],1)],1)],1),t("el-form-item",{staticClass:"offset-label",attrs:{label:"执行时间",prop:"onceTime"}},[t("el-row",{directives:[{name:"show",rawName:"v-show",value:e.currentType==e.timerTypes.one||e.currentType==e.timerTypes.day,expression:"currentType == timerTypes.one || currentType == timerTypes.day"}]},[t("el-col",{staticStyle:{display:"flex"},attrs:{span:24}},[t("el-time-select",{attrs:{clearable:!1,"picker-options":{start:e.HMStart,step:"00:01",end:e.HMStop},placeholder:"选择时间"},on:{change:e.HSchangedHandler},model:{value:e.tempTask.onceTime,callback:function(t){e.$set(e.tempTask,"onceTime",t)},expression:"tempTask.onceTime"}})],1),t("el-col",{directives:[{name:"show",rawName:"v-show",value:e.currentType==e.timerTypes.one,expression:"currentType == timerTypes.one "}],staticStyle:{display:"flex"},attrs:{span:24}},[t("el-date-picker",{attrs:{clearable:!1,"picker-options":{start:e.HMStart,step:"00:01",end:e.HMStop},placeholder:"选择时间",disabled:""},model:{value:e.tempTask.onceDate,callback:function(t){e.$set(e.tempTask,"onceDate",t)},expression:"tempTask.onceDate"}})],1)],1),t("el-row",{directives:[{name:"show",rawName:"v-show",value:e.currentType==e.timerTypes.week,expression:"currentType == timerTypes.week"}]},[t("el-col",{staticStyle:{display:"flex"},attrs:{span:24}},[t("el-select",{staticClass:"xl-timer-prefix-week",attrs:{placeholder:"",clearable:!1,editable:!1,multiple:"","collapse-tags":""},on:{change:e.weekDaySelectChange},model:{value:e.tempTask.weeksSelected,callback:function(t){e.$set(e.tempTask,"weeksSelected",t)},expression:"tempTask.weeksSelected"}},e._l(e.weekDays,(function(e){return t("el-option",{key:e.day+"_week_key",attrs:{value:e.index,label:e.normal}})})),1),t("el-tooltip",{attrs:{content:e.weeksSelectedShow,placement:"top",effect:"light"}},[t("div",{staticClass:"xl-timer-select-show"},[e._v(" "+e._s(e.weeksSelectedShow)+" ")])])],1),t("el-col",{staticStyle:{display:"flex"},attrs:{span:24}},[t("el-time-select",{attrs:{clearable:!1,editable:!1,"picker-options":{start:e.HMStart,step:"00:01",end:e.HMStop},placeholder:"选择时间"},on:{change:e.HSchangedHandler},model:{value:e.tempTask.onceTime,callback:function(t){e.$set(e.tempTask,"onceTime",t)},expression:"tempTask.onceTime"}})],1)],1),t("el-row",{directives:[{name:"show",rawName:"v-show",value:e.currentType==e.timerTypes.month,expression:"currentType == timerTypes.month"}]},[t("el-col",{staticStyle:{display:"flex"},attrs:{span:24}},[t("el-select",{staticClass:"xl-timer-prefix-month",attrs:{multiple:"","collapse-tags":""},on:{change:e.monthDaySelectChange},model:{value:e.tempTask.monthsSelected,callback:function(t){e.$set(e.tempTask,"monthsSelected",t)},expression:"tempTask.monthsSelected"}},e._l(31,(function(e,s){return t("el-option",{key:s+"_month_key",attrs:{value:e,label:e}})})),1),t("el-tooltip",{attrs:{content:e.monthsSelectedShow,placement:"top",effect:"light"}},[t("div",{staticClass:"xl-timer-select-show"},[e._v(" "+e._s(e.monthsSelectedShow)+" ")])])],1),t("el-col",{staticStyle:{display:"flex"},attrs:{span:24}},[t("el-time-select",{attrs:{clearable:!1,editable:!1,"picker-options":{start:e.HMStart,step:"00:01",end:e.HMStop},placeholder:"选择时间"},on:{change:e.HSchangedHandler},model:{value:e.tempTask.onceTime,callback:function(t){e.$set(e.tempTask,"onceTime",t)},expression:"tempTask.onceTime"}})],1)],1)],1),t("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.currentType!=e.timerTypes.one,expression:"currentType != timerTypes.one"}],staticClass:"offset-label",attrs:{label:"执行区间",prop:"startDate"}},[t("el-row",{staticClass:"xl-timer-range-after"},[t("el-col",{staticStyle:{display:"flex"},attrs:{span:24}},[t("el-date-picker",{attrs:{clearable:!1,editable:!1,"picker-options":{start:e.HMStart,step:"00:01",end:e.HMStop},placeholder:"选择时间"},on:{change:e.startDateChg},model:{value:e.tempTask.startDate,callback:function(t){e.$set(e.tempTask,"startDate",t)},expression:"tempTask.startDate"}})],1),t("el-col",{staticStyle:{display:"flex"},attrs:{span:24}},[t("el-date-picker",{attrs:{clearable:!1,editable:!1,"picker-options":{start:e.HMStart,step:"00:01",end:e.HMStop},placeholder:"选择时间"},on:{change:e.endDateChg},model:{value:e.tempTask.endDate,callback:function(t){e.$set(e.tempTask,"endDate",t)},expression:"tempTask.endDate"}})],1)],1)],1),t("el-form-item",{staticStyle:{"padding-left":"10px"},attrs:{label:"任务备注",prop:"name"}},[t("el-row",[t("el-col",{attrs:{span:24}},[t("el-input",{attrs:{type:"textarea",placeholder:""},model:{value:e.tempTask.content,callback:function(t){e.$set(e.tempTask,"content",t)},expression:"tempTask.content"}})],1)],1)],1),t("div",{directives:[{name:"show",rawName:"v-show",value:-1==e.selectedTaskIndex,expression:"selectedTaskIndex==-1"}],staticClass:"footer"},[t("el-button",{staticClass:"button-plugin",staticStyle:{color:"white","border-radius":"5px"},attrs:{"data-auth":"timer-update",type:"primary",size:"small"},on:{click:e.sendData}},[t("i",{staticClass:"el-icon-check"}),e._v(" 确定 ")]),t("el-button",{staticClass:"button-plugin button-plugin-white",staticStyle:{color:"#2c87ff",border:"1px solid #2c87ff","border-radius":"5px"},attrs:{type:"small",size:"small"},on:{click:e.cancelData}},[t("i",{staticClass:"i-white el-icon-close"}),e._v(" 取消 ")])],1),t("div",{directives:[{name:"show",rawName:"v-show",value:-1!=e.selectedTaskIndex,expression:"selectedTaskIndex!=-1"}],staticClass:"footer-edit"},[t("el-button",{staticClass:"button-plugin",staticStyle:{color:"white","border-radius":"5px"},attrs:{"data-auth":"timer-add",type:"primary",size:"small"},on:{click:e.sendData}},[t("i",{staticClass:"el-icon-check"}),e._v(" 确定 ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.currentType!==e.timerTypes.one&&!e.isSelectedDisabled,expression:"currentType!==timerTypes.one&&!isSelectedDisabled"}],staticClass:"button-plugin button-plugin-blue",staticStyle:{color:"#2c87ff",border:"1px solid #2c87ff","border-radius":"5px"},attrs:{"data-auth":"timer-disable",type:"small",size:"small"},on:{click:e.disabledOne}},[t("i",{staticClass:"el-icon-minus"}),e._v(" 禁用 ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.currentType!==e.timerTypes.one&&e.isSelectedDisabled,expression:"currentType!==timerTypes.one&&isSelectedDisabled"}],staticClass:"button-plugin button-plugin-blue",staticStyle:{color:"#2c87ff",border:"1px solid #2c87ff","border-radius":"5px"},attrs:{"data-auth":"timer-active",type:"small",size:"small"},on:{click:e.activeOne}},[t("i",{staticClass:"el-icon-check"}),e._v(" 启用 ")]),t("el-button",{staticClass:"button-plugin button-plugin-red",staticStyle:{color:"#2c87ff",border:"1px solid #2c87ff","border-radius":"5px"},attrs:{"data-auth":"timer-delete",type:"small",size:"small"},on:{click:e.deleteOne}},[t("i",{staticClass:"i-red el-icon-delete"}),e._v(" 删除 ")])],1)],2)],1):e._e(),t("div",{staticClass:"page"},[t("i",{staticClass:"page-act el-icon-arrow-left",on:{click:function(t){return e.prePage(!0)}}})]),t("div",{staticClass:"page-right"},[t("i",{staticClass:"page-act el-icon-arrow-right",on:{click:function(t){return e.prePage(!1)}}})]),t("div",{staticClass:"title"},e._l(e.weekDays,(function(s,i){return t("el-tooltip",{key:"week-"+i,attrs:{content:s.text,placement:"top",effect:"light"}},[t("div",{staticClass:"title-week",attrs:{"data-day":s.day,"data-time":s.time}},[e._v(" "+e._s(s.text)+" ")])])})),1),t("div",{ref:"scrollView",staticClass:"all x-scroll-white"},[t("div",{staticClass:"times"},e._l(e.clocks48,(function(s,i){return t("div",{key:"clock-unit-"+i,staticClass:"clock-unit"},[e._v(" "+e._s(s)+" ")])})),0),t("div",{ref:"taskView",staticClass:"jobs",on:{click:e.clickTaskViews}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.mouseEdit,expression:"mouseEdit"}],staticClass:"mask"}),e._l(e.invalidList,(function(s,i){return t("div",{key:"clock_invalid_"+i,class:e.getClass(s.state),style:e.getStyle(s),attrs:{"data-day":s.day,"data-hour":s.hour,"data-min":s.min,"data-index":i,"data-type":e.unitType.task,"data-task":s.type}},[t("div",{key:"clock_invalid_block_"+i,staticClass:"type-one task-clock-one task-invalid task-invalid-block",attrs:{"data-index":i,"data-type":e.unitType.task,"data-task":s.type}}),t("el-tooltip",{attrs:{content:s.name,placement:"right",effect:"dark"}},[t("p",[e._v(" "+e._s(s.name)+" ")])]),t("p",{staticClass:"date"},[e._v(" "+e._s(+(s.hour>9?s.hour:"0"+s.hour)+":"+(s.min>9?s.min:"0"+s.min)+(s.endTime?s.endTime:""))+" ")])],1)})),e.searchDOM?t("div",{staticClass:"task-to-search",style:e.getStyle(e.searchDOM),attrs:{"data-day":e.searchDOM.day,"data-date":e.searchDOM.date,"data-hour":e.searchDOM.hour,"data-min":e.searchDOM.min,"data-type":e.unitType.task,"data-task":e.searchDOM.type}}):e._e(),e._l(e.list,(function(s,i){return t("div",{key:"clock_"+i,class:e.getBaseClassByType(s),style:e.getStyle(s),attrs:{"data-day":s.day,"data-date":s.date,"data-hour":s.hour,"data-min":s.min,"data-index":i,"data-type":e.unitType.task,"data-task":s.type}},[t("el-tooltip",{attrs:{content:s.name,placement:"right",effect:"dark"}},[t("p",[e._v(" "+e._s(s.name)+" ")])]),t("p",[e._v(" "+e._s(e.getTimerExcuteDate(s))+" ")])],1)})),e._l(e.unit48,(function(s){return t("div",{key:"job-one-"+s,staticClass:"job-one"},e._l(e.weekDays,(function(i,a){return t("div",{key:"week-"+a,class:"job-one-ceil row-"+s+" column-"+a,attrs:{"data-type":e.unitType.free,"data-start":s,"data-time":i.time,"data-day":i.day,title:e._f("indexTilte")(s)}})})),0)}))],2)])]),t("el-dialog",{staticClass:"schedule",attrs:{title:"任务详情",visible:e.dialogVisible2,width:"300px","before-close":e.scheduleDialogClose},on:{"update:visible":function(t){e.dialogVisible2=t}}},[t("el-row",{staticStyle:{width:"150px",height:"30px","margin-top":"-20px"}}),t("el-row",[t("span",{staticClass:"content"},[e._v(" 任务名称 "),t("span",[e._v(e._s(e.schedule.name))])])]),t("el-row",[t("span",{staticClass:"content"},[e._v(" 任务状态 "),t("span",[t("img",{attrs:{src:1===e.schedule.state?e.SUCCESS:e.ERROR}}),e._v(" "+e._s(1===e.schedule.state?"执行成功":"执行失败")+" ")])])]),t("el-row",[t("span",{staticClass:"content"},[e._v(" 任务备注 "),t("span",[e._v(e._s(e.schedule.content))])])]),t("el-row",[t("span",{staticClass:"content"},[e._v(" 任务时间 "),t("span",[e._v(e._s(e.$moment(e.schedule.excuteTime).format("YYYY-MM-DD HH:mm:ss")+e.schedule.endTime))])])]),t("el-row",[t("span",{staticClass:"content"},[e._v(" 重复设置 "),t("span",[e._v(e._s(e.timerTypeCN(e.schedule.type)))])])])],1),t("el-dialog",{staticClass:"schedule",attrs:{title:"确认提醒",visible:e.delDialogVisible,width:"350px"},on:{"update:visible":function(t){e.delDialogVisible=t}}},[t("el-row",{staticStyle:{"padding-left":"40px","margin-bottom":"20px"}},[t("span",[e._v("您要删除"),t("span",{staticStyle:{color:"#008CFF"}},[e._v("本次任务，")]),e._v("还是"),t("span",{staticStyle:{color:"#008CFF"}},[e._v("全部的任务？")])])]),t("el-row",{staticStyle:{"text-align":"center","margin-bottom":"20px"}},[t("el-button",{staticClass:"timer-btn",attrs:{icon:"el-icon-aim",type:"primary"},on:{click:e.deleteSingle}},[e._v(" 仅本次 ")]),t("el-button",{staticClass:"timer-btn",attrs:{icon:"el-icon-menu",type:"primary"},on:{click:e.deleteAll}},[e._v(" 全部任务 ")])],1)],1)],1)],1)],1)},a=[],n=(s("14d9"),s("1e70"),s("79a4"),s("c1a1"),s("8b00"),s("a4e7"),s("1e5a"),s("72c3"),s("4452")),r=s("ecc8"),o=s.n(r),l=s("6b94"),c=s.n(l),d=(s("2147"),s("e350"));const h={one:1,day:2,week:3,month:4},m=864e5;var u={components:{},filters:{indexTilte(e){let t,s,i=Math.floor(e/2),a=e%2?30:0;return e%2?(t=i+1,s=0):(t=i,s=30),i=i>9?i:"0"+i,a=a>9?a:"0"+a,t=t>9?t:"0"+t,s=s>9?s:"0"+s,`${i}:${a}~${t}:${s}`}},props:{},data(){return{siteListForJump:[],isJump:!1,isJumpAble:!1,editAble:!0,addAble:!0,SUCCESS:o.a,ERROR:c.a,siteID:null,mouseEdit:!1,searchDOM:null,siteName:"计划任务",ceilWidth:240,curentLeft:0,curentTop:0,selectedTaskIndex:-1,selectedTaskEditDay:-1,selectedTaskEditDate:-1,editTarget:null,editTargetMatchObj:null,schedule:{},unitType:{free:"free",task:"task"},baseLeft:0,baseTop:220,dialogVisible:!1,dialogVisible2:!1,delDialogVisible:!1,adding:!0,currentType:null,timerTypes:h,currentDate:null,currentDateInit:null,img:{bottom:s("a2dc")},list:[],invalidList:[],baseList:[],missionList:[],videoSourceTypes:{wide:{value:2,name:"广角镜头"},zoom:{value:3,name:"变焦镜头"},red:{value:4,name:"红外镜头"}},tempTask:{siteID:"",endSiteID:null,mode:1,day:3,weekDay:1,hour:11,min:30,end:!1,time:null,content:"",startDate:"",endDate:"",onceTime:"00:00",missionID:null,name:null,monthsSelected:[],weeksSelected:[],onceDate:null,cameraConfig:{videoSourceType:1,mediaStorageViewTypeArray:[]}},HMStart:"00:00",HMStop:"23:59"}},computed:{weeksSelectedShow(){let e="";if(this.tempTask.weeksSelected.length>0&&(e=this.getWeekDayCn2(this.tempTask.weeksSelected[0]),this.tempTask.weeksSelected.length>1))for(let t=1;t<this.tempTask.weeksSelected.length;t+=1)e=`${e}、${this.getWeekDayCn2(this.tempTask.weeksSelected[t])}`;return e},monthsSelectedShow(){let e="";if(this.tempTask.monthsSelected.length>0&&(e=""+this.tempTask.monthsSelected[0],this.tempTask.monthsSelected.length>1))for(let t=1;t<this.tempTask.monthsSelected.length;t+=1)e=`${e}、${this.tempTask.monthsSelected[t]}`;return e},selectedWeekDays(){if(this.selectedTaskIndex>-1){const e=this.getBaseItemCopyByCMID(this.list[this.selectedTaskIndex].CMID);let t=[];for(const i of e.weekDay)i!==this.selectedTaskEditDay&&t.push(i);t.push(new Date(1e3*this.list[this.selectedTaskIndex].excuteTime).getDay()),t=Array.from(new Set(t)),t.sort((e,t)=>e-t);let s="";return t.forEach(e=>{s=s+this.getWeekDayCn2(e)+"、"}),s}return this.getWeekDayCn2(this.tempTask.day)},unit48(){const e=[];for(let t=0;t<48;t+=1)e.push(t);return e},rules(){let e={missionID:[{required:!0,message:"请选择任务",trigger:"blur"}],endSiteID:[{required:!0,message:"请选择降落站点",trigger:"blur"}],mode:[{required:!0,message:"请选择重复设置",trigger:"blur"}],onceTime:[{required:!0,message:"请选择执行时间",trigger:"blur"}]};return this.currentType===this.timerTypes.one?e.time=[{required:!0,message:"请选择执行时间",trigger:"blur"}]:this.currentType===this.timerTypes.day?(e.time=[{required:!0,message:"请选择执行时间",trigger:"blur"}],e.startDate=[{required:!0,message:"请选择执行开始时间",trigger:"blur"}],e.endDate=[{required:!0,message:"请选择执行结束时间",trigger:"blur"}]):this.currentType===this.timerTypes.week?(e.startDate=[{required:!0,message:"请选择执行开始时间",trigger:"blur"}],e.endDate=[{required:!0,message:"请选择执行结束时间",trigger:"blur"}],e.time=[{required:!0,message:"请选择执行结束时间",trigger:"blur"}]):this.currentType===this.timerTypes.month?(e.time=[{required:!0,message:"请选择执行时间",trigger:"blur"}],e.startDate=[{required:!0,message:"请选择执行开始时间",trigger:"blur"}],e.endDate=[{required:!0,message:"请选择执行结束时间",trigger:"blur"}]):e={},e},isSelectedDisabled(){if(this.selectedTaskIndex>=0){const e=this.list[this.selectedTaskIndex];if(e&&e.type!==h.one&&e.isDisabled)return!0}return!1},isSelectedActive(){if(this.selectedTaskIndex>=0){const e=this.list[this.selectedTaskIndex];if(e&&e.type!==h.one&&!e.isDisabled)return!0}return!1},updateDeleteStyle(){return`left:${this.curentLeft}px;top:${this.curentTop}px;`},weekDays(){const e=[],t=m;for(let s=0;s<7;s+=1){const i=new Date(this.currentDate+s*t);let a="";a=this.getWeekDayCn(i.getDay())+" ";const n=this.getDateDay(i),r={day:i.getDay(),time:i.getTime(),text:`${n}/${a}`,normal:a,index:i.getDay()};e.push(r)}return e},clocks48(){const e=[];for(let t=0;t<24;t+=1){let s=t;s=s<10?"0"+s:s,e.push(s+":00"),e.push(s+":30")}return e.push("24:00"),e}},watch:{searchDOM(e){this.dialogVisible=!!e},selectedTaskIndex(e){this.dialogVisible=e>-1},currentType(e){this.isEditing||(this.searchDOM?(this.tempTask.weeksSelected=[this.searchDOM.day],this.tempTask.monthsSelected=[new Date(this.searchDOM.time).getDate()],this.tempTask.startDate=new Date(this.get0ClockTimeStempToday()),this.tempTask.endDate=new Date(this.get0ClockTimeStempToday()+30*m),e===h.week?this.tempTask.endDate=new Date(this.get0ClockTimeStempToday()+30*m):e===h.month&&(this.tempTask.endDate=new Date(this.get0ClockTimeStempToday()+90*m))):(this.tempTask.weeksSelected=[],this.tempTask.monthsSelected=[]))},rules(){}},created(){this.initData(),this.siteID=this.$route.query.siteID,this.currentDate=this.get0ClockTimeStempToday(),this.currentDateInit=this.get0ClockTimeStempToday(),this.tempTask.startDate=new Date(this.get0ClockTimeStempToday()),this.tempTask.endDate=new Date(this.get0ClockTimeStempToday()+30*m),this.searchDOM=null,this.getMissionList(),this.getSiteDetail(),this.getHistoryList(),this.getTimerList(),this.getSiteList()},mounted(){this.initMouseAction(),window.addEventListener("resize",this.resizeHandler),this.$nextTick(()=>{this.ceilWidth=this.$refs.taskView.clientWidth/7,this.$refs.taskView.scrollTop=960})},beforeDestroy(){window.removeEventListener("resize",this.resizeHandler),this.cancelMouseAction()},methods:{resizeHandler(){this.ceilWidth=this.$refs.taskView.clientWidth/7},timerTypeCN(e){let t="未知";switch(e){case h.one:t="单次";break;case h.day:t="每天";break;case h.week:t="每周";break;case h.month:t="每月";break;default:t="未知"}return t},getTimerExcuteDate(e){const t=`${e.hour>9?e.hour:"0"+e.hour}:${e.min>9?e.min:"0"+e.min}`;let s=e.min+30,{hour:i}=e;s>=60&&(s-=60,i+=1);const a=`${i>9?i:"0"+i}:${s>9?s:"0"+s}`;return`${t}~${a}`},startDateChg(e){e.getTime()>=this.tempTask.endDate.getTime()&&(this.$message.error("开始时间必须小于结束时间！"),this.$nextTick(()=>{this.currentType===h.week?this.tempTask.startDate=new Date(this.tempTask.endDate.getTime()-30*m):this.currentType===h.month&&(this.tempTask.startDate=new Date(this.tempTask.endDate.getTime()-90*m))}))},endDateChg(e){e.getTime()<=this.tempTask.startDate.getTime()&&(this.$message.error("结束时间必须大于开始时间！"),this.$nextTick(()=>{this.currentType===h.week?this.tempTask.endDate=new Date(this.tempTask.startDate.getTime()+30*m):this.currentType===h.month&&(this.tempTask.endDate=new Date(this.tempTask.startDate.getTime()+90*m))}))},weekDaySelectChange(e){console.log(e),console.log(this.tempTask.weeksSelected)},monthDaySelectChange(e){console.log(e),console.log(this.tempTask.monthsSelected)},getSource(e){let t="未知来源";return 1===e.missionSource?t="祺云下发":2===e.missionSource?t="祺云定时计划任务":3===e.missionSource&&(t="三方平台"),`[${t}]`},setTempTaskByCMID(e){if(!e)return;const{CMID:t}=e,{hour:s}=e,{min:i}=e;if(t)for(const r of this.baseList){if(!r)break;if(r.CMID===t){var a,n;const e=JSON.parse(JSON.stringify(r));Object.assign(this.tempTask,e),this.isJumpAble&&e.endSiteID!==e.siteID&&(this.isJump=!0),this.tempTask.weeksSelected=e.weekDay,this.tempTask.monthsSelected=e.day,this.currentType=e.mode,this.tempTask.cameraConfig.videoSourceType=null!==e&&void 0!==e&&null!==(a=e.cameraConfig)&&void 0!==a&&a.videoSourceType?e.cameraConfig.videoSourceType:1,this.tempTask.cameraConfig.mediaStorageViewTypeArray=null!==e&&void 0!==e&&null!==(n=e.cameraConfig)&&void 0!==n&&n.mediaStorageViewTypeArray?e.cameraConfig.mediaStorageViewTypeArray:[],e.mode===this.timerTypes.one?(this.tempTask.time=1e3*e.excuteTime,this.tempTask.onceDate=this.$moment(1e3*e.excuteTime).format("YYYY-MM-DD"),this.tempTask.onceTime=`${s>9?s:"0"+s}:${i>9?i:"0"+i}`):(this.tempTask.onceTime=`${s>9?s:"0"+s}:${i>9?i:"0"+i}`,this.tempTask.startDate=new Date(1e3*e.startDate),this.tempTask.endDate=new Date(1e3*e.endDate),this.tempTask.missionID=e.missionID)}}},HSchangedHandler(e){const t=e.split(":"),s=parseInt(t[0]),i=parseInt(t[1]),a=new Date(this.tempTask.time);a.setHours(s),a.setMinutes(i),this.tempTask.hour=s,this.tempTask.min=i,this.tempTask.time=a.getTime();const n=document.getElementsByClassName("job-hilight")[0];if(n){const e={};e.hour=s,e.min=i,e.excuteTime=a,e.day=a.getDay(),n.style=this.getStyle(e)}else this.searchDOM.hour=s,this.searchDOM.min=i},async getSiteList(){const{code:e,data:t,reason:s}=await Object(n["m"])();if(this.statusInclude(e)){let e=t.list.find(e=>e.siteID===this.siteID);e=e||{siteSFMode:0},this.isJumpAble=2===e.siteSFMode,this.siteListForJump=t.list.filter(e=>e.siteID!==this.siteID&&2===e.siteSFMode)}else this.$message({type:"error",message:s})},async getSiteDetail(){const{code:e,data:t,reason:s}=await this.$store.dispatch("site/getSiteDetail",{siteID:this.siteID});this.statusInclude(e)?this.siteName=`${this.siteName}【${t.siteName}】`:this.$message({type:"error",message:s})},async getMissionList(){if(this.siteID){const{data:e}=await Object(n["j"])(this.siteID);this.missionList=(null===e||void 0===e?void 0:e.list)||[],0===this.missionList.length?this.$message("该站点不存在任务数据！"):this.tempTask.missionID=this.missionList[0].missionID}},showHistoryScheduleInfo(e){this.schedule=e,this.dialogVisible2=!0},scheduleDialogClose(){this.dialogVisible2=!1},async getHistoryList(){let e=(new Date).getTime();const t=this.currentDate+7*m;e=e<t?e:t;const{code:s,data:i}=await Object(n["i"])(this.siteID,this.currentDate/1e3,parseInt(e/1e3));this.statusInclude(s)&&null!==i&&void 0!==i&&i.list&&this.renderInvalidListByHistory(i.list)},async getTimerList(){const e=this.currentDate+7*m,{code:t,data:s,reason:i}=await Object(n["l"])(parseInt(this.currentDate/1e3),parseInt(e/1e3),this.siteID);this.statusInclude(t)?(this.baseList=[],this.list=[],null!==s&&void 0!==s&&s.list&&(this.baseList=s.list,this.getListByCrons(JSON.parse(JSON.stringify(this.baseList))))):this.$message({type:"error",message:i})},renderInvalidListByHistory(e){this.invalidList=[],0!==e.length&&e.forEach(e=>{let t;t=e.UAVEXStartTime?new Date(e.UAVEXStartTime):new Date(1e3*e.excuteTime);const s={},i=6e4;if(s.name=e.missionName,s.type=this.timerTypes.one,s.excuteTime=t.getTime(),s.hour=t.getHours(),s.day=t.getDay(),s.min=t.getMinutes(),s.state=e.state,s.hour_origin=s.hour,s.min_origin=e.min,s.missionID=e.missionID,s.missionSource=e.missionSource,s.endTime="",e.UAVEXEndTime){let t=new Date(e.UAVEXEndTime).getHours(),a=new Date(e.UAVEXEndTime).getMinutes();t=t>9?t:"0"+t,a=a>9?a:"0"+a,s.endTime=`~${t}:${a}`;const n=Math.ceil((new Date(e.UAVEXEndTime).getTime()-s.excuteTime)/i);s.ht=n>9?n:10}this.invalidList.push(s)})},getListByCrons(e){if(this.list=[],0===e.length)return;const t=[];e.forEach(e=>{const{excuteList:s}=e;s&&s.length>0&&s.forEach(s=>{if(0===s.isExcute){const i=this.refactorCron(s,e);t.push(i)}})}),this.list=t},refactorCron(e,t){const s={},i=new Date(1e3*e.excuteTime);return s.name=t.missionName,s.isDisabled=e.isDisabled,s.type=t.mode,s.hour=t.hour,s.min=t.min,s.CMID=t.CMID,s.excuteTime=e.excuteTime,s.day=i.getDay(),s.date=i.getDate(),s.excuteTime_origin=e.excuteTime,s.day_origin=s.day,s.hour_origin=i.getHours(),s.min_origin=i.getMinutes(),s.hour=s.hour_origin,s.min=s.min_origin,s},disabledOne(){this.selectedTaskIndex<0||this.$confirm("确定禁用该计划任务?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=this.list[this.selectedTaskIndex];this.disabledOneAjax(e.CMID,e.excuteTime),this.delDialogVisible=!1})},async disabledOneAjax(e,t){const{code:s,reason:i}=await Object(n["d"])(e,t);this.statusInclude(s)?(this.selectedTaskIndex=-1,this.cancelHilightTaskSelected(),this.getHistoryList(),this.getTimerList(),this.$message({type:"success",message:"禁用成功!"}),this.initData()):this.$message({type:"error",message:i})},activeOne(){if(this.selectedTaskIndex<0)return;const e=this.list[this.selectedTaskIndex];this.$confirm("确定激活该计划任务?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.activeAction(e.CMID,e.excuteTime)})},deleteOne(){this.delDialogVisible=!0},delDialogClose(){this.delDialogVisible=!1,this.isEditing=!1,this.selectedTaskIndex=-1,this.cancelHilightTaskSelected()},async deleteSingle(){if(this.selectedTaskIndex<0)return;this.delDialogVisible=!1;const e=this.list[this.selectedTaskIndex],t=e.CMID;let s=0;e.type!==h.one&&(s=e.excuteTime);const{code:i,reason:a}=await Object(n["d"])(t,s);this.statusInclude(i)?(this.selectedTaskIndex=-1,this.isEditing=!1,this.cancelHilightTaskSelected(),this.getHistoryList(),this.getTimerList(),this.$message({type:"success",message:"删除成功!"}),this.currentType=this.timerTypes.one):this.$message({type:"error",message:a})},async deleteAll(){if(this.selectedTaskIndex<0)return;this.delDialogVisible=!1;const e=this.list[this.selectedTaskIndex],t=e.CMID,{code:s,reason:i}=await Object(n["d"])(t,0);this.statusInclude(s)?(this.selectedTaskIndex=-1,this.isEditing=!1,this.cancelHilightTaskSelected(),this.getHistoryList(),this.getTimerList(),this.$message({type:"success",message:"删除成功!"}),this.currentType=this.timerTypes.one):this.$message({type:"error",message:i})},async activeAction(e,t){const{code:s,reason:i}=await Object(n["a"])(e,t);this.statusInclude(s)?(this.selectedTaskIndex=-1,this.cancelHilightTaskSelected(),this.getHistoryList(),this.getTimerList(),this.$message({type:"success",message:"激活成功!"}),this.initData()):this.$message({type:"error",message:i})},updateDailyTasksByCMID(e,t,s,i){let a=t;for(const n of this.list)n.CMID===e&&(n.day=a,n.hour=s,n.min=i,n.day_origin=a,n.hour_origin=s,n.min_origin=i,a+=1)},initData(){this.tempTask={siteID:"",endSiteID:null,mode:1,day:3,weekDay:1,hour:11,min:30,end:!1,time:null,content:"",startDate:new Date(this.get0ClockTimeStempToday()),endDate:"",onceTime:"00:00",missionID:null,name:null,monthsSelected:[],weeksSelected:[],onceDate:null,cameraConfig:{videoSourceType:1,mediaStorageViewTypeArray:[]}},this.currentType=this.timerTypes.one,this.isEditing=!1,this.selectedTaskIndex=-1,this.dialogVisible=!1,this.searchDOM=null,this.tempTask.endDate=new Date(this.tempTask.startDate+30*m),0!==this.missionList.length&&(this.tempTask.missionID=this.missionList[0].missionID)},async updateTimer(e){const{code:t,data:s,reason:i}=await Object(n["q"])(e);if(this.statusInclude(t)){this.$message({type:"success",message:"编辑成功!"}),this.cancelHilightTaskSelected();const t=e.CMID;for(let s=0;s<this.baseList.length;s+=1)if(this.baseList[s].CMID===t){this.baseList[s]=e;break}if(this.currentType!==h.day)for(const s of this.list)s.CMID===t&&(s.hour=e.hour,s.min=e.min,s.hour_origin=e.hour,s.min_origin=e.min);this.initData(),delete s.excuteList,delete s.time,this.getHistoryList(),this.getTimerList()}else this.$message({type:"error",message:i})},getBaseItemCopyByCMID(e){let t=null;for(const s of this.baseList)if(s.CMID===e){t=JSON.parse(JSON.stringify(s));break}return t},async addTimer(e){const{code:t,reason:s}=await Object(n["b"])(e);this.statusInclude(t)?(this.getHistoryList(),this.getTimerList(),this.$message({type:"success",message:"添加成功!"}),this.initData()):this.$message({type:"error",message:s})},doUpateTimer(){const e=JSON.parse(JSON.stringify(this.tempTask));e.excuteTime=e.time/1e3,delete e.excuteList,delete e.time,e.day=[],e.weekDay=[];const t=this.getBaseItemCopyByCMID(this.list[this.selectedTaskIndex].CMID);e.startDate=this.tempTask.startDate/1e3,e.endDate=this.tempTask.endDate/1e3;let s=[];if(e.mode===h.week){for(const e of t.weekDay)e!==this.selectedTaskEditDay&&s.push(e);s.push(new Date(1e3*this.list[this.selectedTaskIndex].excuteTime).getDay()),e.weekDay=s}else if(e.mode===h.month){for(const e of t.day)e!==this.selectedTaskEditDate&&s.push(e);s.push(new Date(1e3*this.list[this.selectedTaskIndex].excuteTime).getDate()),s=Array.from(new Set(s)),e.day=s}e?(delete e.endSiteID,this.isJumpAble&&this.isJump&&this.tempTask.endSiteID&&(e.endSiteID=this.tempTask.endSiteID),this.updateTimer(e)):console.error("查无此对象！")},doCancel(){const e=document.getElementsByClassName("job-hilight")[0];e&&this.editRecoverPostion(e),this.cancelHilightTaskSelected(),this.selectedTaskIndex=-1,this.isEditing=!1,this.currentType=this.timerTypes.one,this.clearMatchedView()},get0ClockTimeStempToday(e=new Date){const t=e.getFullYear(),s=e.getMonth(),i=e.getDate();return new Date(t,s,i,0,0,0,0).getTime()},getPreciseByHourAndMin(e,t,s){const i=new Date(e+60*t*60*1e3+60*s*1e3).getTime();return i},getAddData(){const e=this.missionList.filter(e=>e.missionID===this.tempTask.missionID);this.tempTask.name=e[0].missionName;const t={hour:-1,min:-1,excuteTime:-1,weekDay:[],day:[],siteID:this.siteID,mode:this.currentType,missionName:this.tempTask.name,missionID:this.tempTask.missionID,content:this.tempTask.content};return this.isJumpAble&&this.isJump&&this.tempTask.endSiteID&&(t.endSiteID=this.tempTask.endSiteID),this.currentType===h.one?t.excuteTime=this.tempTask.time/1e3:(this.get0ClockTimeStempToday()===this.tempTask.startDate.getTime()?t.startDate=(new Date).getTime()/1e3+60:t.startDate=this.tempTask.startDate.getTime()/1e3,t.endDate=(this.tempTask.endDate.getTime()+(m-1e3))/1e3,t.hour=this.tempTask.hour,t.min=this.tempTask.min,this.currentType===h.day||(this.currentType===h.week?t.weekDay=this.tempTask.weeksSelected:this.currentType===h.month&&(t.day=this.tempTask.monthsSelected))),t},sendData(){this.$refs.dataForm.validate(e=>{if(!e)return!1;if(this.isEditing)this.doUpateTimer();else{const e=this.getAddData();this.addTimer(e)}})},cancelData(){this.searchDOM=null,this.isEditing||this.list.pop(),this.doCancel()},tempTaskClear(){if(this.tempTask){const e=Object.keys(this.tempTask);for(const t of e)this.tempTask[t]=null}},getWeekDayCn(e){const t={0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"};return t[e]},getWeekDayCn2(e){const t={0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"};return t[e]},setCurretnType(e){this.currentType=e},prePage(e){this.doCancel(),this.list=[],this.invalidList=[],this.searchDOM=null,e?this.currentDate-=7*m:this.currentDate+=7*m,this.currentDateInit>this.currentDate?this.addAble=!1:this.addAble=!0;const t=(new Date).getTime();t>=this.currentDate+7*m?this.getHistoryList():(t<=this.currentDate||this.getHistoryList(),this.getTimerList())},clickTaskViews(e){if(!(e.target.className.indexOf("task-to-search")>-1||this.isEditing||this.currentDate+7*m<(new Date).getTime())){if(this.searchDOM=null,this.doCancel(),e.target.className.indexOf("job-one-ceil")>-1){if(!Object(d["b"])("plan","plan","add")&&!this.addAble)return;const{dataset:t}=e.target,s=parseInt(t.start),i=parseInt(t.time),a=parseInt(t.day),n=Math.floor(s/2),r=s%2?30:0;if(this.currentType===h.one){const e=new Date,t=new Date(i);if(a===e.getDay()&&t.getDate()===e.getDate()&&(n<e.getHours()||n===e.getHours()&&r<=e.getMinutes()))return this.$message({type:"error",message:"无效的时间段！"}),!1}const o={type:this.currentType,day:a,hour:n,min:r,time:this.getPreciseByHourAndMin(i,n,r),name:""};this.tempTask.onceDate=this.$moment(o.time).format("YYYY-MM-DD"),this.currentType!==h.week&&(this.tempTask.date=new Date(i).getDate());const l=this.calculateAvailableTimes(o);if(l){const e=l[0];e.hour===o.hour&&e.min>o.min&&(o.min=e.min),Object.assign(this.tempTask,o),this.$nextTick(()=>{this.searchDOM=o,this.tempTask.weeksSelected=[o.day],this.tempTask.monthsSelected=[new Date(o.time).getDate()],this.tempTask.onceTime=`${o.hour>9?o.hour:"0"+o.hour}:${o.min>9?o.min:"0"+o.min}`})}}if(e.target.className.indexOf("task-clock-one")>-1||e.target.parentNode.className.indexOf("task-clock-one")>-1){let{target:t}=e;if(e.target.parentNode.className.indexOf("task-clock-one")>-1&&(t=e.target.parentNode),t.className.indexOf("task-invalid")>-1)return void this.showHistoryScheduleInfo(this.invalidList[parseInt(t.dataset.index)]);this.isEditing=!0;const s=parseInt(t.dataset.index);this.selectedTaskIndex=s,this.selectedTaskEditDay=parseInt(t.dataset.day),this.selectedTaskEditDate=parseInt(t.dataset.date);const i=this.list[s];this.setTempTaskByCMID(i),this.hilightTaskSelected(t);let a=parseInt(t.style.left.split("px")[0])+e.offsetX+20,n=parseInt(t.style.top.split("px")[0])+e.offsetY;const r=7*this.ceilWidth-50,o=2760;a=a>r?r:a,n=n>o?o:n,this.curentLeft=a,this.curentTop=n}}},editRecoverPostion(e){const t=e||document.getElementsByClassName("job-hilight")[0];if(!t)return;const{dataset:s}=t,i=parseInt(s.index);if(this.list[i]){const e=this.getBaseItemCopyByCMID(this.list[i].CMID);if(e){const s=this.list[i],a=s.hour_origin,n=s.min_origin,r=s.day_origin,o=e.mode,l={hour:a,min:n,day:r,type:o};t.style=this.getStyle(l),this.list[i].hour=a,this.list[i].min=n;const c=new Date(parseInt(1e3*this.list[i].excuteTime_origin));this.tempTask.onceDate=this.$moment(c).format("YYYY-MM-DD"),this.tempTask.onceTime=`${a>9?a:"0"+a}:${n>9?n:"0"+n}`}}},getDateDay(e){let t=e.getMonth()+1;const s=e.getFullYear()+"-";let i=e.getDate();return t=t>9?t:"0"+t,i=i>9?i:"0"+i,`${s+t}-${i}`},getBaseClassByType(e){const{type:t}=e;let s;switch(t){case h.one:s="type-one";break;case h.day:s="type-day";break;case h.week:s="type-week";break;case h.month:s="type-month";break}let i=s+"  task-clock-one";return e.isDisabled&&(i+=" task-disabled"),i},getClass(e){let t="type-one task-clock-one task-invalid";return 1!==e&&(t+=" task-fail"),t},getStyle(e){const t=2;let s="position:absolute;display:flex;flex-direction:column;";const{hour:i}=e,{min:a}=e,n=e.day;s=`${s}top:${120*i+a*t}px;`;const r=new Date(this.currentDate).getDay();let o=n-r;return n<r&&(o+=7),s=`${s}left:${o*this.ceilWidth}px;`,s=`${s}width:${this.ceilWidth}px;`,e.ht&&(s=`${s}height:${2*e.ht}px;`),s},initMouseAction(){const e=this;this.$refs.taskView.onmousedown=t=>{let{target:s}=t;"p"===t.target.nodeName.toLowerCase()&&(s=t.target.parentNode);const i=parseInt(s.dataset.index);e.isEditing&&s.dataset.type&&s.dataset.type===e.unitType.task&&i===e.selectedTaskIndex&&(s.leftOffset=t.offsetX,s.topOffset=t.offsetY,e.editTarget=s,e.editTarget.style.cursor="move")},this.$refs.taskView.onmousemove=t=>{if(t.stopPropagation(),t.cancelBubble=!0,e.isEditing&&e.editTarget){e.mouseEdit=!0;let s=t.offsetX-e.ceilWidth/2;s=s<0?0:s,s=s>6*this.ceilWidth?6*this.ceilWidth:s;let i=t.offsetY-30;i=i<0?0:i,i=i>2820?2820:i;let a=`position:absolute;left:${s}px;`;a=`${a}top:${i}px;`,a=`${a}width:${e.ceilWidth}px;`,e.editTarget.style=a,e.clearMatchedView(),e.editTargetMatchObj=null;const n=Math.ceil(t.offsetY/60)-1,r=Math.ceil(t.offsetX/this.ceilWidth)-1;e.taskCollisonDetector(n,r)}},this.$refs.taskView.onmouseup=()=>{this.mouseEdit=!1,e.isEditing&&(e.clearMatchedView(),e.editTargetMatchObj?(e.list[e.selectedTaskIndex].hour=e.editTargetMatchObj.hour,e.list[e.selectedTaskIndex].min=e.editTargetMatchObj.min,e.list[e.selectedTaskIndex].day=e.editTargetMatchObj.day,e.tempTask.time=e.editTargetMatchObj.time,e.tempTask.hour=e.editTargetMatchObj.hour,e.tempTask.min=e.editTargetMatchObj.min,e.tempTask.day=e.editTargetMatchObj.day,e.list[e.selectedTaskIndex].excuteTime=e.editTargetMatchObj.time/1e3,e.editTarget&&(e.editTarget.style=e.getStyle(e.editTargetMatchObj))):e.editRecoverPostion()),e.editTarget=null}},hilightTaskSelected(e){e&&(e.className+=" job-hilight")},cancelHilightTaskSelected(){const e=Array.from(document.getElementsByClassName("job-hilight"));for(let t=0;t<e.length;t+=1)e[t].className=e[t].className.replace("job-hilight","")},cancelMouseAction(){this.$refs.taskView.onmousedown=null,this.$refs.taskView.onmouseup=null,this.$refs.taskView.onmousemove=null},clearMatchedView(){let e=document.getElementsByClassName("best-match");e=Array.from(e);for(const t of e)t.className=t.className.replace(" best-match","")},getTasksByDay(e){let t=document.getElementsByClassName("task-clock-one");const s=[];t=Array.from(t);for(const i of t){const t=parseInt(i.dataset.index);if(t===this.selectedTaskIndex)continue;const a=parseInt(i.dataset.day);a===e&&s.push(i)}return s},taskCollisonDetector(e,t){let s=null,i=!1;const a=Math.floor(e/2);let n=Math.floor(e%2);n>0&&(n=30);const r=new Date,o=r.getHours(),l=r.getMinutes();0===t&&(a<o||a===o&&n>l)&&(i=!0);const c=document.querySelector(`div.row-${e}.column-${t}`),{dataset:d,className:h}=c;if(c&&!i){const e=parseInt(d.time),t=parseInt(d.day);s={type:this.list[this.selectedTaskIndex].type,day:t,hour:a,min:n,time:this.getPreciseByHourAndMin(e,a,n),name:this.list[this.selectedTaskIndex].name};const i=120*a+2*n,r=this.getTasksByDay(t);for(const a of r){const e=parseInt(a.style.top.split("px")[0]);if(e>=i&&e<i+60){s=null;break}if(e<i&&e+60>i){s=null;break}}}if(s){const e=new Date(parseInt(d.time));this.tempTask.onceDate=this.$moment(e).format("YYYY-MM-DD"),this.tempTask.onceTime=`${a>9?a:"0"+a}:${n>9?n:"0"+n}`,-1===h.indexOf("best-match")&&(c.className+=" best-match"),this.editTargetMatchObj=s}else this.editTargetMatchObj=null},getHourMinByIndex(e){let t=null;return e>=0&&e<48&&(t={hour:Math.floor(e/2),min:e%2?30:0}),t},calculateAvailableTimes(e){const{hour:t,min:s,day:i}=e,a=this.getTasksByDay(i),n={hour:t,min:s},r={hour:0===s?t:t+1,min:0===s?30:0};let o=null,l=null;for(const u of a){const e=parseInt(u.dataset.hour),t=parseInt(u.dataset.min);let s=e,i=t+30;if(i>=60&&(++s,i-=60),e===n.hour&&(0===n.min&&t>0&&t<30||30===n.min&&t>30&&t<60))return!1;(s<n.hour||s===n.hour&&i<=n.min||s===n.hour&&i>n.min&&(e<n.hour||e===n.hour&&t<n.min))&&(o?(s>o.hour||s===o.hour&&i>=o.min)&&(o.hour=s,o.min=i):o={hour:s,min:i}),(e>r.hour||e===r.hour&&t>=r.min)&&(l?(e<l.hour||e===l.hour&&t<=l.min)&&(l.hour=e,l.min=t):l={hour:e,min:t})}if(o||(o={hour:0,min:0}),l||(l={hour:23,min:59}),o&&l){const t=60*o.hour+o.min,s=60*l.hour+l.min,i=s-t;if(i<30)return!1;const a=new Date(e.time);a.setHours(o.hour),a.setMinutes(o.min);const n=new Date(e.time);n.setHours(l.hour),n.setMinutes(l.min),this.HMStart=`${o.hour>9?o.hour:"0"+o.hour}:${o.min>9?o.min:"0"+o.min}`,this.HMStop=`${l.hour>9?l.hour:"0"+l.hour}:${l.min>9?l.min:"0"+l.min}`}const c=new Date,d=c.getDay(),h=c.getHours(),m=c.getMinutes();return d===c&&(o.hour<h?o.hour=h:o.hour===h&&o.min<=m&&(o.min=m)),[o,l]}}},p=u,T=(s("0f2e"),s("5eeb"),s("2877")),g=Object(T["a"])(p,i,a,!1,null,"6007ba83",null);t["default"]=g.exports},e9bc:function(e,t,s){"use strict";var i=s("dc19"),a=s("cb27").add,n=s("83b9e"),r=s("7f65"),o=s("5388");e.exports=function(e){var t=i(this),s=r(e).getIterator(),l=n(t);return o(s,(function(e){a(l,e)})),l}},ecc8:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAYNJREFUOE+dkksoRGEUx//nzkxTxpCMR80khTE1C4YsRGRHmYXrsfVYyMJq1izYKBtRNvLYKs2GZqGUukxRaoSF50JZEKsxGPM6upc77jUzlG/1db7/79/5zvkTNMe767SZDG8+FribGM7PJz4HYzOetCxsdVw+qXJSL72So5cFXgGjUGv2LeQwWBjxt9355ZoCKhBhA+C0UTYYICZGvwxTl1Rdkkev1wwqyC7WVwkcTgnJGhIl+zQIk39B485FmMiEuYtRgIUZEvfsxwDqfgN9rmW02DoxdNiI5/gDmOiUxD1HFGBzLnDCvQ5PUSsGglVI8vuXjGI6UHa2GgsxddavCGbrt1GV78bggQeRxKPWO6JrtSKvDnMNAVyEj8FguAo8GDtqx2P05kdDdJIxnGJzJZaa9hWhL+TF7Uso8xfycHqCZaVCynClXUezrQ8WoxU792sZUHod/w6AailK5X0g4yrA1hypeSbGsC5yqlANOYi9AGoJHGPCpcAIvCcs89qQfwDK75ZV+/N7zwAAAABJRU5ErkJggg=="}}]);
//# sourceMappingURL=chunk-0c18082c.1725872215737.js.map