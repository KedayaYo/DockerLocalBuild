(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d9877ff0"],{"38b7":function(e,t,s){},4468:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"users-wrapper has-padding"},[t("el-card",[t("el-title",{attrs:{slot:"header"},slot:"header"},[e._v(" 用户管理 ")]),t("el-form",{attrs:{size:"small",inline:!0}},[t("el-form-item",[t("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.tableConfig.userName,callback:function(t){e.$set(e.tableConfig,"userName","string"===typeof t?t.trim():t)},expression:"tableConfig.userName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{"&click":function(t){return e.handleQuery.apply(null,arguments)}}},[e._v(" 查询 ")])],1),t("el-form-item",{directives:[{name:"permission",rawName:"v-permission",value:"users/users/add",expression:"'users/users/add'"}],staticClass:"float-right"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(t){e.dialogVisible=!0}}},[e._v(" 新建 ")])],1)],1),t("div",{staticClass:"el-card-body-wrap x-scroll-white"},[e._l(e.userList,(function(s){return t("TableGrid",{key:s.id,attrs:{"user-details":s},on:{"reset:password":e.updateUserPassword}},[t("el-switch",{attrs:{slot:"switch"},on:{change:function(t){return e.updateUserStates(s)}},slot:"switch",model:{value:s.status,callback:function(t){e.$set(s,"status",t)},expression:"user.status"}}),t("el-button",{staticClass:"sky-danger",attrs:{slot:"button",type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.handleDelete(s)}},slot:"button"},[e._v(" 删除 ")])],1)})),t("div",{staticClass:"pagination-wrap"},[t("el-pagination",{attrs:{background:"",layout:"prev, pager, next, total","page-size":e.tableConfig.size,total:e.tableConfig.total},on:{"current-change":e.handleChangePage}})],1)],2)],1),t("el-dialog",{staticClass:"protective-line",attrs:{center:"",visible:e.dialogVisible,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-title",{attrs:{slot:"title"},slot:"title"},[e._v(" 新建用户 ")]),t("el-form",{ref:"AddUserForm",attrs:{model:e.userInformation,"label-position":"left","label-width":"80px",rules:e.rules}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[t("el-input",{model:{value:e.userInformation.userName,callback:function(t){e.$set(e.userInformation,"userName",t)},expression:"userInformation.userName"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"姓名",prop:"realName"}},[t("el-input",{model:{value:e.userInformation.realName,callback:function(t){e.$set(e.userInformation,"realName",t)},expression:"userInformation.realName"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[t("el-input",{model:{value:e.userInformation.phone,callback:function(t){e.$set(e.userInformation,"phone",t)},expression:"userInformation.phone"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"password","show-password":!0},model:{value:e.userInformation.password,callback:function(t){e.$set(e.userInformation,"password",t)},expression:"userInformation.password"}})],1)],1)],1),t("el-form-item",{attrs:{label:"角色",prop:"roleIDs"}},[t("el-select",{model:{value:e.userInformation.roleIDs,callback:function(t){e.$set(e.userInformation,"roleIDs",t)},expression:"userInformation.roleIDs"}},[e._l(e.roles,(function(s){return[s.hidden?e._e():t("el-option",{key:s.id,attrs:{value:s.id,label:s.roleName}})]}))],2)],1),t("el-form-item",{attrs:{label:"地址"}},[t("el-input",{model:{value:e.userInformation.address,callback:function(t){e.$set(e.userInformation,"address",t)},expression:"userInformation.address"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-circle-check",loading:e.submiting},on:{click:function(t){return e.submit("AddUserForm")}}},[e._v("确定")]),t("el-button",{attrs:{size:"small",icon:"el-icon-circle-close"},on:{click:e.handleClose}},[e._v("取消")])],1)],1)],1)},i=[],a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"row-grid-wrap"},[t("div",{staticClass:"grid-column pic"},[t("el-avatar",{attrs:{size:"large",src:e.circleUrl}})],1),t("div",{staticClass:"grid-column position-left"},[e._v(" "+e._s(e.userDetails.userName)+" ")]),t("div",{staticClass:"grid-column position-left role-list"},e._l(e.userDetails.roleList,(function(s){return t("el-tag",{key:s.roleId,attrs:{size:"small"}},[e._v(" "+e._s(s.roleName)+" ")])})),1),t("div",{staticClass:"grid-column position-left"},[t("i",{staticClass:"el-icon-user-solid"}),e._v(" "+e._s(e.userDetails.realName)+" ")]),t("div",{staticClass:"grid-column position-left"},[t("i",{staticClass:"el-icon-mobile-phone"}),e._v(" "+e._s(e.userDetails.phone)+" ")]),t("div",{staticClass:"grid-column position-left"},[t("i",{staticClass:"el-icon-location-outline"}),e._v(" "+e._s(e.userDetails.address)+" ")]),t("div",{staticClass:"grid-column"},[t("el-button",{attrs:{size:"mini",plain:"",type:"primary",icon:"el-icon-unlock"},on:{click:function(t){return e.$emit("reset:password",e.userDetails)}}},[e._v(" 重置密码 ")])],1),t("div",{staticClass:"grid-column"},[e._t("switch")],2),t("div",{staticClass:"grid-column"},[e._t("button")],2)])},o=[],n=s("af1f"),l=s.n(n),u={name:"Grid",filters:{UserRoleFilter(e){const t={2:"管理员",3:"操作员",4:"访客"};return t[e]}},props:{userDetails:{type:Object,default(){return{realName:"",phone:""}}}},data(){return{circleUrl:l.a,effective:!0}}},c=u,d=(s("dcc4"),s("2877")),m=Object(d["a"])(c,a,o,!1,null,"2848662c",null),f=m.exports,p=s("61f7"),h=s("ed08"),g=s("514b");const b={userName:"",realName:"",phone:"",password:"",address:"",status:1,roleIDs:""};var v={name:"Users",components:{TableGrid:f},filters:{},data(){const e=(e,t,s)=>{const r=/^(?:[\u4e00-\u9fa5·]{2,16})$/,i=/(^[a-zA-Z][a-zA-Z\s]{0,20}[a-zA-Z]$)/;return t?r.test(t)||i.test(t)?s():s("正确姓名"):s("请输入姓名")};return{dialogVisible:!1,submiting:!1,roles:[],userList:[],userInformation:{userName:"",realName:"",phone:"",password:"",address:"",status:1,roleIDs:""},tableConfig:{total:0,page:1,size:20,userName:""},userRoles:{},rules:{realName:[{required:!0,validator:e,trigger:"blur"}],phone:[{required:!0,validator:p["g"],trigger:"blur"}],userName:[{required:!0,validator:p["l"],trigger:"blur"}],password:[{required:!0,validator:p["h"],trigger:"blur"}],roleIDs:[{required:!0,message:"请选择用户角色",trigger:"change"}]}}},mounted(){this.getUserList(),this.fetch();try{const e=Object(h["a"])("urole");this.userRoles=JSON.parse(e),console.log(this.userRoles)}catch(e){console.error(e)}},methods:{handleQuery(){this.getUserList()},handleClose(){var e;this.dialogVisible=!1,this.userInformation=this.$deepClone(b),null===(e=this.$refs)||void 0===e||e.AddUserForm.resetFields()},handleChangePage(e){this.tableConfig.page=e,this.getUserList()},submit(e){this.submiting=!0,this.$refs[e].validate(async e=>{if(e){const e=await this.$store.dispatch("user/userAdd",{...this.userInformation,roleIDs:[this.userInformation.roleIDs]});this.submiting=!1,Object(g["a"])(e.code)?(this.$message.success("新增成功"),this.handleClose(),this.getUserList()):this.$message.error("新增失败:"+e.reason)}this.submiting=!1})},updateUserPassword(e){this.$prompt("请输入密码","重置密码",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^[\w]{6,16}$/,inputErrorMessage:"6-16位、数字、大小写字母"}).then(({value:t})=>{try{this.updateUserInformation({...e,password:t}).then(e=>{Object(g["a"])(e.code)&&(this.$message({type:"success",message:"重置密码成功"}),this.getUserList())}).catch(this.$message.error)}catch(s){this.$message.error(s)}}).catch(()=>{this.$message({type:"info",message:"取消"})})},updateUserStates(e){var t;const s={status:e.status?1:0,userID:e.id,PLATIDS:(null===e||void 0===e?void 0:e.PLATList.map(({id:e})=>e))||[],roleIDs:(null===(t=e.roleList)||void 0===t?void 0:t.map(({id:e})=>e))||[]};this.updateUserInformation(s,!1).then(e=>{Object(g["a"])(e.code)&&(this.$message.success("用户状态已更新"),this.getUserList())}).catch(this.$message.error("更新失败，请联系管理员"))},updateUserInformation(e,t=!0){return new Promise((s,r)=>{this.$store.dispatch("user/updateUserInformation",t?this.formatParams(e):e).then(s).catch(r)})},formatParams(e){var t;return{...e,status:e.status?1:0,userID:e.id,PLATIDS:(null===e||void 0===e?void 0:e.PLATList.map(({id:e})=>e))||[],roleIDs:(null===(t=e.roleList)||void 0===t?void 0:t.map(({id:e})=>e))||[]}},handleDelete(e){this.$store.dispatch("user/deleteUserById",{userID:e.id}).then(e=>{Object(g["a"])(e.code)&&(this.$message.success("用户已删除"),this.getUserList())}).catch(e=>{console.log(e)})},getUserList(){this.$store.dispatch("user/getUserList",this.tableConfig).then(e=>{var t;this.userList=(null===(t=e.data.list)||void 0===t?void 0:t.map(e=>({...e,status:0!==e.status})))||[],this.tableConfig={...this.tableConfig,total:e.data.total}}).catch(e=>{console.log(e)})},async fetch(){const e=await this.$store.dispatch("role/fetch");this.roles=e.data.filter(e=>e.roleCode!==this.userRoles[0].roleCode)}}},w=v,A=(s("f088"),Object(d["a"])(w,r,i,!1,null,"f07eb67e",null));t["default"]=A.exports},"61f7":function(e,t,s){"use strict";s.d(t,"l",(function(){return r})),s.d(t,"g",(function(){return i})),s.d(t,"h",(function(){return a})),s.d(t,"b",(function(){return o})),s.d(t,"d",(function(){return n})),s.d(t,"i",(function(){return l})),s.d(t,"a",(function(){return u})),s.d(t,"j",(function(){return c})),s.d(t,"k",(function(){return d})),s.d(t,"c",(function(){return m})),s.d(t,"e",(function(){return f})),s.d(t,"f",(function(){return p}));s("d9e2");const r=(e,t,s)=>{const r=/^[a-zA-Z0-9-_]{3,15}$/;t?r.test(t)?s():s(new Error("请输入不包含特殊字符的3-15位的合法用户名")):s(new Error("请输入用户名"))},i=(e,t,s)=>{const r=/^1(3\d|4[5-9]|5[0-35-9]|6[2567]|7[0-8]|8\d|9[0-35-9])\d{8}$/;if(r.test(t))return s();s(new Error("请输入合法的手机号"))};function a(e,t,s){const r=/^[\w.]{6,16}$/;return t?r.test(t)&&-1===t.indexOf("@")?s():s("6~16位，包含大小写字母和数字的组合"):s("请输入密码")}function o(e,t,s){const r=/^[a-zA-Z0-9_-]{10,40}$/;return t?r.test(t)?s():s(new Error("请输入合法机库编号,长度在10-40位字符")):s()}function n(e,t,s){const r=/^[a-zA-Z0-9_-]{10,40}$/;return t?r.test(t)?s():s(new Error("请输入无人机编号，长度在10-40位字符")):s()}function l(e,t,s){const r=/^[A-Z0-9]{13,30}$/;return r.test(t)?s():s(new Error("请输入合法SN编号"))}function u(e,t,s){return isNaN(t)?(s(new Error("非法的数值！")),!1):(s(),!0)}function c(e,t,s){const r=/^ST_[0-9]{8}$/;return t?r.test(t)?s():s(new Error("编号示例：ST_00000001")):s(new Error("请输入站点编号"))}function d(e,t,s){const r=/^[a-zA-Z,0-9,\u4E00-\uFA29,_,#]{4,16}$/;return r.test(t)?s():s(new Error("请输入合法站点名称（4-15个字符）"))}function m(e,t,s){return t>=5?s():s(new Error("返航悬停高度至少5米"))}function f(e,t,s){return t=t.toString(),t=t.replace(" ",""),""===t.trim()||isNaN(Number(t,10))?s(new Error("无效的数字")):s()}function p(e,t,s){const[r,i]=t.split(","),a=/^[\-\+]?(0(\.\d{1,10})?|([1-9](\d)?)(\.\d{1,10})?|1[0-7]\d{1}(\.\d{1,10})?|180\.0{1,10})$/,o=/^[\-\+]?((0|([1-8]\d?))(\.\d{1,10})?|90(\.0{1,10})?)$/;return a.test(r)&&o.test(i)?(s(),!0):(s(new Error("坐标例:121.3245671,31.123456")),!1)}},8967:function(e,t,s){},af1f:function(e,t){e.exports="data:image/png;base64,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"},dcc4:function(e,t,s){"use strict";s("8967")},f088:function(e,t,s){"use strict";s("38b7")}}]);
//# sourceMappingURL=chunk-d9877ff0.1725872215737.js.map